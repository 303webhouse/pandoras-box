<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Pandora - Real-time Trading Signal Dashboard">
    <title>Pandora</title>
    <link rel="stylesheet" href="/styles.css?v=37">
    <link rel="manifest" href="/manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbit&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#0a0e27">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo">
                    <img src="/assets/pandora-logo.png" alt="Pandora" class="logo-icon">
                    <span class="logo-text">PANDORA</span>
                </div>
                <div class="status-group">
                    <div class="connection-status" id="connectionStatus">
                        <span class="status-dot"></span>
                        <span class="status-text">Connecting...</span>
                    </div>
                    <div class="pivot-health header-pivot" id="pivotHealth" data-pivot-health="true">
                        <span class="pivot-dot">o</span>
                        <span class="pivot-text">Pivot unknown</span>
                    </div>
                </div>
            </div>
            <div class="header-controls">
                <div class="mode-switcher" role="tablist" aria-label="App Mode">
                    <button class="mode-btn active" id="modeHubBtn" data-mode="hub" role="tab" aria-selected="true">Equities Swinger</button>
                    <button class="mode-btn" id="modeCryptoBtn" data-mode="crypto" role="tab" aria-selected="false">Crypto Scalper</button>
                </div>
                <a href="/knowledgebase" class="kb-btn" title="Knowledgebase">üìö KB</a>
                <button class="refresh-btn" id="refreshBtn">‚Üª Refresh</button>
            </div>
        </header>

        <main id="hubShell" class="hub-shell">

        <!-- Bias Indicators -->
        <section class="bias-section">

            <div class="bias-composite-panel" id="biasCompositePanel">
                <div class="bias-composite-header">
                    <div class="bias-composite-title">
                        <h2>MARKET BIAS</h2>
                        <div class="redis-health" id="redisHealth" data-redis-health="true">
                            <span class="redis-dot">o</span>
                            <span class="redis-text">Redis unknown</span>
                        </div>
                    </div>
                    <div class="bias-composite-actions">
                        <button class="bias-settings-btn" id="dailyBiasSettingsBtn" title="Daily Bias Factor Settings">D&#9881;</button>
                        <button class="bias-settings-btn" id="weeklyBiasSettingsBtn" title="Weekly Bias Factor Settings">W&#9881;</button>
                        <button class="bias-settings-btn" id="cyclicalBiasSettingsBtn" title="Cyclical Bias Factor Settings">C&#9881;</button>
                        <button class="savita-update-btn" id="savitaUpdateBtn" title="Update Savita Indicator">
                            Savita
                        </button>
                        <div class="bias-override-controls">
                            <select id="compositeOverrideSelect" class="bias-override-select">
                                <option value="">Override Bias...</option>
                                <option value="TORO_MAJOR">TORO MAJOR</option>
                                <option value="TORO_MINOR">TORO MINOR</option>
                                <option value="NEUTRAL">NEUTRAL</option>
                                <option value="URSA_MINOR">URSA MINOR</option>
                                <option value="URSA_MAJOR">URSA MAJOR</option>
                            </select>
                            <button class="composite-override-btn" id="compositeOverrideApply">Apply</button>
                            <button class="composite-override-btn secondary" id="compositeOverrideClear">Clear</button>
                        </div>
                    </div>
                </div>

                <div class="bias-banner" id="compositeBiasBanner">
                    <div class="bias-banner-main">
                        <div class="bias-level" id="compositeBiasLevel">NEUTRAL</div>
                        <div class="bias-score" id="compositeBiasScore">(0.00)</div>
                    </div>
                    <div class="confidence-badge" id="compositeConfidence">LOW</div>
                </div>

                <div class="override-indicator" id="compositeOverrideIndicator" style="display: none;"></div>

                <div class="factor-breakdown">
                    <div class="factor-breakdown-header" id="factorBreakdownToggle">
                        <span class="factor-breakdown-caret">></span>
                        <span class="factor-breakdown-title">Factor Breakdown</span>
                        <span class="factor-breakdown-count" id="factorActiveCount">0/20 active</span>
                    </div>
                    <div class="factor-list" id="compositeFactorList" style="display: none;"></div>
                </div>

                <div class="bias-composite-footer">
                    <span class="last-update" id="compositeLastUpdate">Last update: --</span>
                </div>
            </div>

            <!-- Timeframe Factor Group Cards (replace old Daily/Weekly/Cyclical) -->
            <div class="tf-card" id="tfIntraday" data-timeframe="intraday">
                <h3>INTRADAY</h3>
                <div class="tf-display">
                    <div class="tf-level" id="tfIntradayLevel">NEUTRAL</div>
                    <div class="tf-score" id="tfIntradayScore">(0.00)</div>
                    <div class="tf-momentum" id="tfIntradayMomentum"><span class="tf-momentum-arrow">‚Üí</span> Stable</div>
                </div>
                <div class="tf-divergence" id="tfIntradayDivergence" style="display:none;"></div>
                <div class="tf-factors" id="tfIntradayFactors" style="display:none;"></div>
                <div class="tf-expand-toggle" data-target="tfIntradayFactors">Factors ></div>
            </div>
            <div class="tf-card" id="tfSwing" data-timeframe="swing">
                <h3>SWING</h3>
                <div class="tf-display">
                    <div class="tf-level" id="tfSwingLevel">NEUTRAL</div>
                    <div class="tf-score" id="tfSwingScore">(0.00)</div>
                    <div class="tf-momentum" id="tfSwingMomentum"><span class="tf-momentum-arrow">‚Üí</span> Stable</div>
                </div>
                <div class="tf-divergence" id="tfSwingDivergence" style="display:none;"></div>
                <div class="tf-factors" id="tfSwingFactors" style="display:none;"></div>
                <div class="tf-expand-toggle" data-target="tfSwingFactors">Factors ></div>
            </div>
            <div class="tf-card" id="tfMacro" data-timeframe="macro">
                <h3>MACRO</h3>
                <div class="tf-display">
                    <div class="tf-level" id="tfMacroLevel">NEUTRAL</div>
                    <div class="tf-score" id="tfMacroScore">(0.00)</div>
                    <div class="tf-momentum" id="tfMacroMomentum"><span class="tf-momentum-arrow">‚Üí</span> Stable</div>
                </div>
                <div class="tf-divergence" id="tfMacroDivergence" style="display:none;"></div>
                <div class="tf-factors" id="tfMacroFactors" style="display:none;"></div>
                <div class="tf-expand-toggle" data-target="tfMacroFactors">Factors ></div>
            </div>
        </section>

        <!-- Sector Rotation Strip -->
        <section class="sector-rotation-strip" id="sectorRotationStrip">
            <div class="sector-chips" id="sectorChips">
                <!-- Populated by JS -->
            </div>
        </section>

        <!-- Main Content: Chart + Trade Ideas + Open Positions -->
        <section class="main-content">
            <!-- Chart Area (1/2 width) -->
            <div class="chart-area">
                <div class="chart-tabs" id="chartTabs">
                    <button class="chart-tab active" data-symbol="SPY">SPY</button>
                    <button class="chart-tab" data-symbol="VIX">VIX</button>
                    <button class="chart-tab" data-symbol="BTCUSD">BTC</button>
                </div>
                <div class="chart-container" id="chartContainer">
                    <!-- TradingView Widget -->
                    <div id="tradingview-widget"></div>
                </div>
                
                <!-- Price Levels Panel (shows entry/stop/target for open positions) -->
                <div class="price-levels-panel" id="priceLevelsPanel" style="display: none;">
                    <div class="price-levels-header">
                        <span class="price-levels-ticker" id="priceLevelsTicker">--</span>
                        <span class="price-levels-label">LEVELS</span>
                    </div>
                    <div class="price-levels-content">
                        <div class="price-level entry">
                            <span class="level-label">Entry</span>
                            <span class="level-value" id="priceLevelEntry">--</span>
                        </div>
                        <div class="price-level stop">
                            <span class="level-label">Stop</span>
                            <span class="level-value" id="priceLevelStop">--</span>
                        </div>
                        <div class="price-level target">
                            <span class="level-label">Target 1</span>
                            <span class="level-value" id="priceLevelTarget1">--</span>
                        </div>
                        <div class="price-level target2" id="priceLevelTarget2Row" style="display: none;">
                            <span class="level-label">Target 2</span>
                            <span class="level-value" id="priceLevelTarget2">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trade Ideas (1/4 width) -->
            <div class="trades-panel">
                <!-- Scout Alerts Section (Early Warnings) -->
                <div class="scout-alerts-section" id="scoutAlertsSection">
                    <div class="scout-alerts-header">
                        <div class="scout-header-left">
                            <span class="scout-header-icon">üî≠</span>
                            <span class="scout-header-title">SCOUT ALERTS</span>
                        </div>
                        <span class="scout-alert-count" id="scoutAlertCount" style="display: none;">0</span>
                    </div>
                    <div class="scout-alerts-container" id="scoutAlertsContainer">
                        <p class="scout-empty-state">No active scout alerts</p>
                    </div>
                </div>

                <div class="trades-header">
                    <h2><span class="kb-link" data-kb-term="trade-ideas">TRADE IDEAS</span></h2>
                    <div class="asset-toggle">
                        <button class="toggle-btn active" data-asset="equity">Equities</button>
                        <button class="toggle-btn" data-asset="options">Options</button>
                    </div>
                </div>
                <!-- Equity Signals Container -->
                <div class="signals-container" id="tradeSignals">
                    <!-- Signals will be populated by JavaScript -->
                    <p class="empty-state">No signals available</p>
                </div>
                <!-- Options Tab Content -->
                <div class="options-tab-content" id="optionsTabContent" style="display: none;">
                    <div class="options-header">
                        <h3>Open Options Positions</h3>
                        <button class="options-btn primary" id="openOptionsModalBtn">+ Add Position</button>
                    </div>
                    <!-- Options Summary -->
                    <div class="options-summary" id="optionsSummary">
                        <div class="summary-stat">
                            <span class="stat-label">Open Positions</span>
                            <span class="stat-value" id="optionsCount">0</span>
                        </div>
                        <div class="summary-stat">
                            <span class="stat-label">Total P&L</span>
                            <span class="stat-value" id="optionsTotalPnl">$0.00</span>
                        </div>
                        <div class="summary-stat">
                            <span class="stat-label">Net Delta</span>
                            <span class="stat-value" id="optionsNetDelta">0</span>
                        </div>
                        <div class="summary-stat">
                            <span class="stat-label">Daily Theta</span>
                            <span class="stat-value" id="optionsDailyTheta">$0.00</span>
                        </div>
                    </div>
                    <!-- Options Positions List -->
                    <div class="options-positions-list" id="optionsPositionsList">
                        <p class="empty-state">No open options positions</p>
                    </div>
                </div>
            </div>

            <!-- Open Positions (1/4 width) -->
            <div class="positions-panel">
                <div class="positions-header">
                    <h2>OPEN POSITIONS</h2>
                    <div class="positions-header-actions">
                        <button class="add-position-btn" id="addPositionBtn" data-action="add-manual-position" data-context="equity" title="Add Manual Trade">+</button>
                        <span class="positions-count" id="positionsCount">0</span>
                    </div>
                </div>
                <div class="positions-container" id="openPositions">
                    <p class="empty-state">No open positions</p>
                </div>
            </div>
        </section>

        <!-- Watchlist v3 -->
        <section class="watchlist-section">
            <div class="watchlist-v3">
                <div class="watchlist-left">
                    <div class="watchlist-container">
                        <div class="watchlist-header">
                            <h2>SECTOR OVERVIEW</h2>
                            <div class="watchlist-controls">
                                <div class="watchlist-benchmark" id="watchlist-benchmark"></div>
                                <select id="watchlist-sector-sort" class="watchlist-sort-select">
                                    <option value="strength_rank">By Sector Strength</option>
                                    <option value="change_1d">By Daily Change</option>
                                    <option value="change_1w">By Weekly Change</option>
                                    <option value="signals">By Active Signals</option>
                                </select>
                            </div>
                        </div>
                        <div id="watchlist-grid" class="watchlist-grid">
                            <div class="watchlist-loading">Loading watchlist data...</div>
                        </div>
                        <div class="watchlist-footer">
                            <span id="watchlist-enriched-at"></span>
                            <button id="watchlist-refresh" class="btn-subtle">‚Üª Refresh</button>
                        </div>
                    </div>
                </div>

                <div class="watchlist-middle">
                    <div class="tickers-panel">
                        <div class="tickers-header">
                            <h2>WATCHLIST TICKERS</h2>
                            <div class="tickers-controls">
                                <div class="tickers-control">
                                    <label for="ticker-sort">Sort:</label>
                                    <select id="ticker-sort">
                                        <option value="sector">Sector</option>
                                        <option value="change_1d">Daily Change %</option>
                                        <option value="change_1w">Weekly Change %</option>
                                        <option value="relative_volume">Relative Volume</option>
                                        <option value="cta_zone">CTA Zone</option>
                                    </select>
                                </div>
                                <div class="tickers-control">
                                    <label for="ticker-filter">Filter:</label>
                                    <select id="ticker-filter">
                                        <option value="all">All</option>
                                        <option value="mine">My Watchlist</option>
                                        <option value="positions">Active Positions Only</option>
                                        <option value="scanner">Scanner Universe</option>
                                        <option value="muted">Muted Only</option>
                                    </select>
                                </div>
                                <div class="tickers-meta">
                                    <span id="ticker-count">Showing: 0 tickers</span>
                                    <span id="ticker-positions">Positions: 0 active</span>
                                </div>
                            </div>
                        </div>

                        <div id="ticker-list" class="ticker-list">
                            <div class="watchlist-loading">Loading tickers...</div>
                        </div>

                        <div class="tickers-footer">
                            <button id="tickers-refresh" class="btn-subtle">‚Üª Refresh</button>
                            <span id="tickers-updated-at"></span>
                        </div>

                        <div id="bulk-actions" class="bulk-actions" style="display: none;">
                            <span id="bulk-count">0 selected</span>
                            <button id="bulk-mute">Mute All</button>
                            <button id="bulk-unmute">Unmute All</button>
                            <button id="bulk-remove">Remove All</button>
                            <button id="bulk-cancel">Cancel</button>
                        </div>
                    </div>
                </div>

                <div class="watchlist-right">
                    <div class="analyzer-panel">
                        <div class="analyzer-header">
                            <h2>üî¨ SINGLE TICKER ANALYZER</h2>
                            <div class="analyzer-header-actions">
                                <button class="analyzer-action-btn add-watchlist" id="addToWatchlistBtn" disabled>
                                    + Add to Watchlist
                                </button>
                            </div>
                        </div>
                        <div class="analyzer-controls">
                            <div class="analyzer-input-group">
                                <input type="text" id="analyzeTickerInput" class="analyzer-input" placeholder="Enter ticker to analyze">
                                <select id="analyzeInterval" class="analyzer-interval">
                                    <option value="1d">1D</option>
                                    <option value="4h">4H</option>
                                    <option value="1h">1H</option>
                                    <option value="15m">15M</option>
                                </select>
                                <button class="analyzer-btn" id="analyzeTickerBtn">Analyze</button>
                            </div>
                        </div>

                        <div class="analyzer-results-v3" id="analyzerResultsV3">
                            <p class="empty-state">Enter a ticker to analyze</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Strategy Filter Panel -->
        <section class="strategy-filter-section">
            <div class="strategy-filter-header">
                <h2><span class="icon-teal">&#9881;</span> STRATEGY FILTERS</h2>
                <span class="header-divider">|</span>
                <div class="header-controls">
                    <label class="direction-toggle">
                        <input type="checkbox" id="filterLong" checked>
                        <span class="direction-label long">LONG</span>
                    </label>
                    <label class="direction-toggle">
                        <input type="checkbox" id="filterShort" checked>
                        <span class="direction-label short">SHORT</span>
                    </label>
                    <span class="header-divider">|</span>
                    <label class="min-score-label">Min Score:</label>
                    <input type="number" id="scoreThreshold" class="score-input" min="1" max="100" value="1">
                    <span class="header-divider">|</span>
                    <span class="filter-status"><span id="activeStrategyCount">10</span> strategies, <span id="activeDirections">LONG + SHORT</span>, min <span id="activeMinScore">1</span></span>
                </div>
                <div class="strategy-filter-controls">
                    <button class="filter-btn select-all" id="selectAllStrategies">Select All</button>
                    <button class="filter-btn clear-all" id="clearAllStrategies">Clear All</button>
                </div>
            </div>

            <!-- Strategy Groups (scrollable) -->
            <div class="strategy-groups-container">
                <div class="strategy-groups">
                    <!-- Trend Following -->
                    <div class="strategy-group">
                        <h3 class="strategy-group-title"><span class="icon-teal">&#8593;</span> Trend Following</h3>
                        <div class="strategy-toggles">
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="golden_touch" checked>
                                <span class="strategy-name">Golden Touch</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="pullback_entry" checked>
                                <span class="strategy-name">Pullback Entry</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="taurus_signal" checked>
                                <span class="strategy-name">Taurus Signal</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="triple_line" checked>
                                <span class="strategy-name">Triple Line</span>
                            </label>
                        </div>
                    </div>

                    <!-- Breakout -->
                    <div class="strategy-group">
                        <h3 class="strategy-group-title"><span class="icon-teal">&#9650;</span> Breakout</h3>
                        <div class="strategy-toggles">
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="two_close_vol" checked>
                                <span class="strategy-name">Two-Close + Vol</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="zone_upgrade" checked>
                                <span class="strategy-name">Zone Upgrade</span>
                            </label>
                        </div>
                    </div>

                    <!-- Reversal -->
                    <div class="strategy-group">
                        <h3 class="strategy-group-title"><span class="icon-teal">&#8635;</span> Reversal</h3>
                        <div class="strategy-toggles">
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="exhaustion" checked>
                                <span class="strategy-name">Exhaustion</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="ursa_signal" checked>
                                <span class="strategy-name">Ursa Signal</span>
                            </label>
                        </div>
                    </div>

                    <!-- Macro Confluence -->
                    <div class="strategy-group">
                        <h3 class="strategy-group-title"><span class="icon-teal">&#9673;</span> Macro Confluence</h3>
                        <div class="strategy-toggles">
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="apis_call" checked>
                                <span class="strategy-name">APIS Call</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="kodiak_call" checked>
                                <span class="strategy-name">Kodiak Call</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

        </section>

        <!-- Hybrid Market Scanner (Batch Scan Results) -->
        <section class="hybrid-scanner-section">
            <div class="hybrid-header">
                <h2>üì° <span class="kb-link" data-kb-term="hybrid-scanner">HYBRID BATCH SCANNER</span></h2>
                <div class="hybrid-controls">
                    <button class="hybrid-btn" id="runHybridScanBtn">Scan Watchlist</button>
                </div>
            </div>
            <p class="hybrid-info">Scans your watchlist with Technical + Analyst analysis</p>
            
            <!-- Scan Results Table -->
            <div class="hybrid-results" id="hybridResults" style="display: none;">
                <h3>üìã Scan Results</h3>
                <table class="hybrid-table">
                    <thead>
                        <tr>
                            <th>Ticker</th>
                            <th>Technical</th>
                            <th>Strength</th>
                            <th>Analyst</th>
                            <th>Upside</th>
                            <th>Sector</th>
                        </tr>
                    </thead>
                    <tbody id="hybridTableBody">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Options Flow (Unusual Whales) -->
        <section class="flow-section">
            <div class="flow-header">
                <h2>üêã OPTIONS FLOW</h2>
                <div class="flow-controls">
                    <button class="flow-btn" id="refreshFlowBtn">‚Üª Refresh</button>
                    <span class="flow-status" id="flowStatus">Not Connected</span>
                </div>
            </div>
            <p class="flow-info">Unusual Whales integration ‚Ä¢ Manual entry available ‚Ä¢ Auto-confirms CTA signals</p>
            
            <!-- Hot Tickers -->
            <div class="flow-hot-tickers">
                <h3>üî• Hot Flow</h3>
                <div class="flow-hot-list" id="flowHotList">
                    <p class="empty-state">No flow data yet</p>
                </div>
            </div>
            
            <!-- Recent Alerts -->
            <div class="flow-recent">
                <h3>üìä Recent Alerts</h3>
                <div class="flow-alerts-list" id="flowAlertsList">
                    <p class="empty-state">No recent alerts</p>
                </div>
            </div>
            
            <!-- Manual Entry Button -->
            <div class="flow-manual-entry">
                <button class="flow-btn add full-width" id="openFlowModalBtn">‚ûï Add Flow Observation</button>
            </div>
        </section>

        <!-- Flow Entry Modal -->
        <div class="modal-overlay" id="flowModalOverlay">
            <div class="flow-modal">
                <div class="flow-modal-header">
                    <h2>üêã Add Flow Observation</h2>
                    <button class="modal-close" id="closeFlowModalBtn">‚úï</button>
                </div>
                
                <!-- Notability Score -->
                <div class="flow-score-display" id="flowScoreDisplay">
                    <div class="flow-score-circle" id="flowScoreCircle">
                        <span class="flow-score-value" id="flowScoreValue">0</span>
                    </div>
                    <div class="flow-score-label" id="flowScoreLabel">Fill in details below</div>
                </div>
                
                <div class="flow-modal-body">
                    <!-- Ticker -->
                    <div class="flow-field">
                        <label>Ticker Symbol *</label>
                        <input type="text" id="modalFlowTicker" placeholder="e.g. NVDA" class="flow-modal-input">
                    </div>
                    
                    <!-- Direction -->
                    <div class="flow-field">
                        <label>Direction *</label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="sentiment" data-value="BULLISH">üü¢ Calls (Bullish)</button>
                            <button class="flow-option-btn" data-field="sentiment" data-value="BEARISH">üî¥ Puts (Bearish)</button>
                        </div>
                    </div>
                    
                    <!-- Flow Type -->
                    <div class="flow-field">
                        <label>Flow Type * <span class="field-hint">(Sweeps = most aggressive)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="type" data-value="SWEEP">üî• Sweep</button>
                            <button class="flow-option-btn" data-field="type" data-value="BLOCK">üì¶ Block</button>
                            <button class="flow-option-btn" data-field="type" data-value="UNUSUAL_VOLUME">üìä Unusual Vol</button>
                            <button class="flow-option-btn" data-field="type" data-value="DARK_POOL">üåë Dark Pool</button>
                        </div>
                    </div>
                    
                    <!-- Premium -->
                    <div class="flow-field">
                        <label>Premium Size * <span class="field-hint">(Total $ of the trade)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="premium" data-value="25000">$25K-$50K</button>
                            <button class="flow-option-btn" data-field="premium" data-value="75000">$50K-$100K</button>
                            <button class="flow-option-btn" data-field="premium" data-value="150000">$100K-$250K</button>
                            <button class="flow-option-btn" data-field="premium" data-value="500000">$250K+</button>
                        </div>
                    </div>
                    
                    <!-- Expiry -->
                    <div class="flow-field">
                        <label>Expiry Timeframe <span class="field-hint">(How soon do contracts expire?)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="expiry" data-value="0dte">0DTE</button>
                            <button class="flow-option-btn" data-field="expiry" data-value="week">This Week</button>
                            <button class="flow-option-btn" data-field="expiry" data-value="2-4weeks">2-4 Weeks</button>
                            <button class="flow-option-btn" data-field="expiry" data-value="monthly">Monthly+</button>
                            <button class="flow-option-btn" data-field="expiry" data-value="leaps">LEAPS (6mo+)</button>
                        </div>
                    </div>
                    
                    <!-- Volume vs OI -->
                    <div class="flow-field">
                        <label>Volume vs Open Interest <span class="field-hint">(Is volume unusually high?)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="voloi" data-value="low">Vol < OI</button>
                            <button class="flow-option-btn" data-field="voloi" data-value="normal">Vol ‚âà OI</button>
                            <button class="flow-option-btn" data-field="voloi" data-value="high">Vol > OI</button>
                            <button class="flow-option-btn" data-field="voloi" data-value="extreme">Vol >> OI (5x+)</button>
                        </div>
                    </div>
                    
                    <!-- Repeat Activity -->
                    <div class="flow-field">
                        <label>Repeat Activity? <span class="field-hint">(Same strike getting hit multiple times?)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="repeat" data-value="no">Single Trade</button>
                            <button class="flow-option-btn" data-field="repeat" data-value="yes">Multiple Hits</button>
                        </div>
                    </div>
                    
                    <!-- Notes -->
                    <div class="flow-field">
                        <label>Notes (optional)</label>
                        <input type="text" id="modalFlowNotes" placeholder="e.g. Before earnings, unusual timing..." class="flow-modal-input">
                    </div>
                </div>
                
                <div class="flow-modal-footer">
                    <div class="flow-verdict" id="flowVerdict">
                        <!-- Verdict will appear here -->
                    </div>
                    <button class="flow-btn cancel" id="cancelFlowBtn">Cancel</button>
                    <button class="flow-btn add" id="submitFlowBtn" disabled>Add Flow</button>
                </div>
            </div>
        </div>

        <!-- Strategy Controls -->
        <section class="strategies-section">
            <div class="strategies-header">
                <h2>‚öôÔ∏è STRATEGY CONTROLS</h2>
                <div class="strategies-actions">
                    <button class="strategy-btn-small enable-all" id="enableAllBtn">Enable All</button>
                    <button class="strategy-btn-small disable-all" id="disableAllBtn">Disable All</button>
                </div>
            </div>
            <div class="strategies-grid" id="strategiesGrid">
                <!-- Strategies will be populated by JavaScript -->
                <p class="empty-state">Loading strategies...</p>
            </div>
        </section>

        <!-- Position Entry Modal -->
        <div class="modal-overlay" id="positionEntryModal">
            <div class="position-modal" id="positionModalContainer">
                <div class="position-modal-header">
                    <h2 id="positionModalTitle">üìà Open Position</h2>
                    <button class="modal-close" id="closePositionModalBtn">‚úï</button>
                </div>
                <div class="position-modal-body">
                    <div class="position-ticker-display" id="positionTickerDisplay">AAPL</div>
                    <div class="position-direction-display" id="positionDirectionDisplay">LONG</div>
                    
                    <!-- Trade Type Toggle -->
                    <div class="trade-type-toggle">
                        <button class="trade-type-btn active" data-type="equity" id="tradeTypeEquity">Equity</button>
                        <button class="trade-type-btn" data-type="options" id="tradeTypeOptions">Options</button>
                    </div>
                    
                    <!-- Equity Fields -->
                    <div id="equityFields">
                        <div class="position-field">
                            <label>Entry Price *</label>
                            <input type="number" id="positionEntryPrice" step="0.01" placeholder="e.g. 228.50" class="position-input">
                        </div>
                        
                        <div class="position-field">
                            <label id="positionQtyLabel">Quantity (Shares) *</label>
                            <input type="number" id="positionQuantity" step="1" placeholder="e.g. 100" class="position-input">
                        </div>
                        
                        <div class="position-summary" id="positionSummary">
                            <div class="summary-row">
                                <span>Stop Loss:</span>
                                <span id="summaryStop">--</span>
                            </div>
                            <div class="summary-row">
                                <span>Target:</span>
                                <span id="summaryTarget">--</span>
                            </div>
                            <div class="summary-row">
                                <span>Position Size:</span>
                                <span id="summarySize">$--</span>
                            </div>
                            <div class="summary-row">
                                <span>Risk Amount:</span>
                                <span id="summaryRisk">$--</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Options Fields -->
                    <div id="optionsFields" style="display: none;">
                        <div class="position-field">
                            <label>Strategy *</label>
                            <select id="optPositionStrategy" class="position-input">
                                <option value="LONG_CALL">Long Call</option>
                                <option value="LONG_PUT">Long Put</option>
                                <option value="BULL_CALL_SPREAD">Bull Call Spread</option>
                                <option value="BEAR_PUT_SPREAD">Bear Put Spread</option>
                                <option value="BULL_PUT_SPREAD">Bull Put Spread (Credit)</option>
                                <option value="BEAR_CALL_SPREAD">Bear Call Spread (Credit)</option>
                                <option value="IRON_CONDOR">Iron Condor</option>
                                <option value="STRADDLE">Straddle</option>
                                <option value="STRANGLE">Strangle</option>
                                <option value="CUSTOM">Custom</option>
                            </select>
                        </div>
                        
                        <!-- Option Legs -->
                        <div class="opt-legs-section">
                            <label class="opt-legs-label">Legs</label>
                            <div id="optPositionLegs">
                                <div class="opt-leg-row" data-leg="1">
                                    <div class="opt-leg-fields">
                                        <select class="opt-leg-action position-input-sm">
                                            <option value="BUY">BUY</option>
                                            <option value="SELL">SELL</option>
                                        </select>
                                        <select class="opt-leg-type position-input-sm">
                                            <option value="CALL">CALL</option>
                                            <option value="PUT">PUT</option>
                                        </select>
                                        <input type="number" class="opt-leg-strike position-input-sm" placeholder="Strike" step="0.5">
                                        <input type="date" class="opt-leg-expiry position-input-sm">
                                        <input type="number" class="opt-leg-qty position-input-sm" placeholder="Qty" value="1" min="1" step="1">
                                        <input type="number" class="opt-leg-premium position-input-sm" placeholder="Premium" step="0.01">
                                    </div>
                                </div>
                            </div>
                            <button class="opt-add-leg-btn" id="optPositionAddLeg">+ Add Leg</button>
                        </div>
                        
                        <div class="position-field-row">
                            <div class="position-field half">
                                <label>Net Premium *</label>
                                <input type="number" id="optPositionPremium" step="0.01" placeholder="-250 or 150" class="position-input">
                                <span class="field-hint">Negative = debit, Positive = credit</span>
                            </div>
                            <div class="position-field half">
                                <label>Contracts *</label>
                                <input type="number" id="optPositionContracts" step="1" min="1" value="1" class="position-input">
                            </div>
                        </div>
                        
                        <div class="position-field-row">
                            <div class="position-field half">
                                <label>Max Profit</label>
                                <input type="number" id="optPositionMaxProfit" step="0.01" placeholder="Optional" class="position-input">
                            </div>
                            <div class="position-field half">
                                <label>Max Loss</label>
                                <input type="number" id="optPositionMaxLoss" step="0.01" placeholder="Optional" class="position-input">
                            </div>
                        </div>
                        
                        <div class="position-field">
                            <label>Breakeven</label>
                            <input type="text" id="optPositionBreakeven" placeholder="e.g. 585.50 or 580,590" class="position-input">
                        </div>
                        
                        <div class="position-field">
                            <label>Thesis</label>
                            <textarea id="optPositionThesis" class="position-input" rows="2" placeholder="Why this options trade?"></textarea>
                        </div>
                        
                        <div class="position-summary" id="optionsSummary">
                            <div class="summary-row">
                                <span>Strategy:</span>
                                <span id="optSummaryStrategy">--</span>
                            </div>
                            <div class="summary-row">
                                <span>Direction:</span>
                                <span id="optSummaryDirection">--</span>
                            </div>
                            <div class="summary-row">
                                <span>Net Premium:</span>
                                <span id="optSummaryPremium">$--</span>
                            </div>
                            <div class="summary-row">
                                <span>Max Risk:</span>
                                <span id="optSummaryRisk">$--</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="position-modal-footer">
                    <button class="position-btn cancel" id="cancelPositionBtn">Cancel</button>
                    <button class="position-btn confirm" id="confirmPositionBtn">Open Position</button>
                </div>
            </div>
        </div>

        <!-- Position Close Modal -->
        <div class="modal-overlay" id="positionCloseModal">
            <div class="position-modal">
                <div class="position-modal-header">
                    <h2>üìâ Close Position</h2>
                    <button class="modal-close" id="closeCloseModalBtn">‚úï</button>
                </div>
                <div class="position-modal-body">
                    <div class="position-ticker-display" id="closeTickerDisplay">AAPL</div>
                    
                    <div class="position-field">
                        <label>Exit Price *</label>
                        <input type="number" id="positionExitPrice" step="0.01" placeholder="e.g. 235.00" class="position-input">
                    </div>
                    
                    <div class="position-field">
                        <label id="closeQtyLabel">Quantity to Close *</label>
                        <input type="number" id="closeQuantity" step="1" placeholder="e.g. 50" class="position-input">
                        <small class="qty-hint" id="closeQtyHint">You have 100 shares</small>
                    </div>
                    
                    <div class="position-summary" id="closeSummary">
                        <div class="summary-row">
                            <span>Entry Price:</span>
                            <span id="closeEntryPrice">--</span>
                        </div>
                        <div class="summary-row pnl-row">
                            <span>Realized P&L:</span>
                            <span id="closeRealizedPnL">$--</span>
                        </div>
                    </div>
                </div>
                <div class="position-modal-footer">
                    <button class="position-btn cancel" id="cancelCloseBtn">Cancel</button>
                    <button class="position-btn confirm" id="confirmCloseBtn">Close Position</button>
                </div>
            </div>
        </div>

        <!-- Weekly Bias Factor Settings Modal -->
        <div class="modal-overlay" id="weeklyBiasSettingsModal">
            <div class="factors-modal">
                <div class="factors-modal-header">
                    <h2>Weekly Bias Factors</h2>
                    <button class="modal-close" id="closeWeeklyBiasSettingsBtn">‚úï</button>
                </div>
                <div class="factors-modal-body">
                    <div class="factor-toggle" data-factor="index_trends">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="weekly-bias">Index Trends (SPY/QQQ/IWM/SMH)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="dollar_trend">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="dollar-smile">Dollar Trend (DXY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="sector_rotation">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="sector-rotation">Sector Rotation (XLK vs XLU)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="credit_spreads">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="credit-spreads">Credit Spreads (HYG vs TLT)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="market_breadth">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="market-breadth">Market Breadth (RSP vs SPY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="vix_term_structure">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="vix-term-structure">VIX Term Structure</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-divider"></div>
                    <div class="factor-toggle personal-bias-toggle" data-timeframe="weekly">
                        <label>
                            <input type="checkbox" id="weeklyPersonalBiasToggle" checked>
                            <span class="factor-name">Apply My Personal Bias</span>
                        </label>
                        <span class="factor-note">(adjusts score by +/-1)</span>
                    </div>
                </div>
                <div class="factors-modal-footer">
                    <button class="factors-btn reset" id="resetFactorsBtn">Reset All</button>
                    <button class="factors-btn apply" id="applyFactorsBtn">Apply</button>
                </div>
            </div>
        </div>

        <!-- Daily Bias Factor Settings Modal -->
        <div class="modal-overlay" id="dailyBiasSettingsModal">
            <div class="factors-modal">
                <div class="factors-modal-header">
                    <h2>Daily Bias Factors</h2>
                    <button class="modal-close" id="closeDailyBiasSettingsBtn">‚úï</button>
                </div>
                <div class="factors-modal-body">
                    <div class="factor-toggle" data-factor="spy_rsi">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="rsi">SPY RSI (Momentum)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="vix_level">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="vix-term-structure">VIX Level (Fear)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="tech_leadership">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="daily-bias">Tech Leadership (QQQ vs SPY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="small_cap_risk">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="daily-bias">Small Cap Risk (IWM vs SPY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="spy_trend">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="daily-bias">SPY Trend</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="market_breadth">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="market-breadth">Market Breadth (RSP vs SPY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="tick_breadth">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="tick-breadth">TICK Range Breadth</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-divider"></div>
                    <div class="factor-toggle personal-bias-toggle" data-timeframe="daily">
                        <label>
                            <input type="checkbox" id="dailyPersonalBiasToggle" checked>
                            <span class="factor-name">Apply My Personal Bias</span>
                        </label>
                        <span class="factor-note">(adjusts score by +/-1)</span>
                    </div>
                </div>
                <div class="factors-modal-footer">
                    <button class="factors-btn reset" id="resetDailyFactorsBtn">Reset All</button>
                    <button class="factors-btn apply" id="applyDailyFactorsBtn">Apply</button>
                </div>
            </div>
        </div>

        <!-- Cyclical Bias Factor Settings Modal -->
        <div class="modal-overlay" id="cyclicalBiasSettingsModal">
            <div class="factors-modal">
                <div class="factors-modal-header">
                    <h2>Cyclical Bias Factors</h2>
                    <button class="modal-close" id="closeCyclicalBiasSettingsBtn">‚úï</button>
                </div>
                <div class="factors-modal-body">
                    <div class="factor-toggle" data-factor="sma_200_positions">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="cyclical-bias">200 SMA Positions</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="yield_curve">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="cyclical-bias">Yield Curve</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="credit_spreads">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="credit-spreads">Credit Spreads</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="excess_cape_yield">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="excess-cape-yield">Excess CAPE Yield</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="savita_indicator" style="opacity: 0.6;">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="savita-indicator">Savita (Optional)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="longterm_breadth">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="market-breadth">Long-term Breadth</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="sahm_rule">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="cyclical-bias">Sahm Rule</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-divider"></div>
                    <div class="factor-toggle personal-bias-toggle" data-timeframe="cyclical">
                        <label>
                            <input type="checkbox" id="cyclicalPersonalBiasToggle" checked>
                            <span class="factor-name">Apply My Personal Bias</span>
                        </label>
                        <span class="factor-note">(adjusts score by +/-1)</span>
                    </div>
                </div>
                <div class="factors-modal-footer">
                    <button class="factors-btn reset" id="resetCyclicalFactorsBtn">Reset All</button>
                    <button class="factors-btn apply" id="applyCyclicalFactorsBtn">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Savita Update Modal -->
    <div class="modal-overlay" id="savitaUpdateModal">
        <div class="savita-modal">
            <div class="savita-modal-header">
                <h2>Update Savita Indicator</h2>
                <button class="modal-close" id="closeSavitaModal">‚úï</button>
            </div>
            <div class="savita-modal-body">
                <p class="savita-description">
                    Enter the latest BofA Sell Side Indicator reading from financial news.
                    <br><small>Search: "BofA Sell Side Indicator" or "Savita Subramanian indicator"</small>
                </p>
                <div class="savita-input-group">
                    <label for="savitaReading">Reading (%)</label>
                    <input type="number" id="savitaReading" min="40" max="70" step="0.1" placeholder="e.g., 55.9">
                </div>
                <div class="savita-input-group">
                    <label for="savitaDate">Report Date (optional)</label>
                    <input type="date" id="savitaDate">
                </div>
                <div class="savita-current" id="savitaCurrentInfo">
                    Current: <span id="savitaCurrentReading">--</span>% (updated <span id="savitaLastUpdated">--</span>)
                </div>
            </div>
            <div class="savita-modal-footer">
                <button class="savita-btn cancel" id="cancelSavitaUpdate">Cancel</button>
                <button class="savita-btn submit" id="submitSavitaUpdate">Update</button>
            </div>
        </div>
    </div>

    <!-- Manual Position Entry Modal -->
    <div class="modal-overlay" id="manualPositionModal">
        <div class="modal-content manual-position-modal">
            <div class="modal-header">
                <h3>Add Manual Position</h3>
                <button class="modal-close" id="closeManualPositionBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ticker</label>
                        <input type="text" id="manualTicker" placeholder="AAPL" maxlength="10">
                    </div>
                    <div class="form-group">
                        <label>Direction</label>
                        <select id="manualDirection">
                            <option value="LONG">LONG</option>
                            <option value="SHORT">SHORT</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Account</label>
                        <select id="manualAccount">
                            <option value="MANUAL">Manual / Other</option>
                            <option value="BREAKOUT">Breakout Prop</option>
                            <option value="ROBINHOOD">Robinhood</option>
                            <option value="BROKERAGELINK">401(k) BrokerageLink</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Asset Class</label>
                        <select id="manualAssetClass">
                            <option value="EQUITY">EQUITY</option>
                            <option value="CRYPTO">CRYPTO</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Entry Price</label>
                        <input type="number" id="manualEntryPrice" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" id="manualQuantity" step="1" placeholder="100">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Stop Loss</label>
                        <input type="number" id="manualStopLoss" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Target</label>
                        <input type="number" id="manualTarget" step="0.01" placeholder="0.00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Strategy / Notes</label>
                        <input type="text" id="manualNotes" placeholder="Manual entry, swing trade, etc.">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelManualPositionBtn">Cancel</button>
                <button class="btn-confirm" id="confirmManualPositionBtn">Add Position</button>
            </div>
        </div>
    </div>

    <!-- Options Entry Modal -->
    <div class="modal-overlay" id="optionsModalOverlay" style="display: none;">
        <div class="options-modal">
            <div class="modal-header">
                <h2>Add Options Position</h2>
                <button class="modal-close" id="closeOptionsModalBtn">‚úï</button>
            </div>
            <div class="modal-body">
                <!-- Step 1: Basic Info -->
                <div class="form-section">
                    <h4>Position Details</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Underlying</label>
                            <input type="text" id="optUnderlying" placeholder="SPY" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label>Strategy</label>
                            <select id="optStrategy" class="form-select">
                                <option value="LONG_CALL">Long Call</option>
                                <option value="LONG_PUT">Long Put</option>
                                <option value="BULL_CALL_SPREAD">Bull Call Spread</option>
                                <option value="BEAR_PUT_SPREAD">Bear Put Spread</option>
                                <option value="BULL_PUT_SPREAD">Bull Put Spread (Credit)</option>
                                <option value="BEAR_CALL_SPREAD">Bear Call Spread (Credit)</option>
                                <option value="IRON_CONDOR">Iron Condor</option>
                                <option value="STRADDLE">Straddle</option>
                                <option value="STRANGLE">Strangle</option>
                                <option value="CUSTOM">Custom</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Direction</label>
                            <select id="optDirection" class="form-select">
                                <option value="BULLISH">Bullish</option>
                                <option value="BEARISH">Bearish</option>
                                <option value="NEUTRAL">Neutral</option>
                                <option value="VOLATILITY">Volatility</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- Step 2: Legs -->
                <div class="form-section">
                    <h4>Option Legs</h4>
                    <div class="legs-container" id="optLegsContainer">
                        <!-- Leg 1 (default) -->
                        <div class="leg-row" data-leg="1">
                            <div class="leg-header">
                                <span class="leg-number">Leg 1</span>
                            </div>
                            <div class="leg-fields">
                                <select class="leg-action form-select-sm">
                                    <option value="BUY">BUY</option>
                                    <option value="SELL">SELL</option>
                                </select>
                                <select class="leg-type form-select-sm">
                                    <option value="CALL">CALL</option>
                                    <option value="PUT">PUT</option>
                                </select>
                                <input type="number" class="leg-strike form-input-sm" placeholder="Strike" step="0.5">
                                <input type="date" class="leg-expiry form-input-sm">
                                <input type="number" class="leg-qty form-input-sm" placeholder="Qty" value="1" min="1">
                                <input type="number" class="leg-premium form-input-sm" placeholder="Premium" step="0.01">
                            </div>
                        </div>
                    </div>
                    <button class="add-leg-btn" id="addLegBtn">+ Add Leg</button>
                </div>
                <!-- Step 3: Position Metrics -->
                <div class="form-section">
                    <h4>Position Metrics</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Net Premium</label>
                            <input type="number" id="optNetPremium" placeholder="-250 or 150" class="form-input" step="0.01">
                            <span class="form-hint">Negative = debit, Positive = credit</span>
                        </div>
                        <div class="form-group">
                            <label>Max Profit</label>
                            <input type="number" id="optMaxProfit" placeholder="Optional" class="form-input" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Max Loss</label>
                            <input type="number" id="optMaxLoss" placeholder="Optional" class="form-input" step="0.01">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Breakeven</label>
                            <input type="text" id="optBreakeven" placeholder="585.50 or 580,590" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>Entry Date</label>
                            <input type="date" id="optEntryDate" class="form-input">
                        </div>
                    </div>
                </div>
                <!-- Step 4: Notes -->
                <div class="form-section">
                    <h4>Trade Thesis</h4>
                    <textarea id="optThesis" class="form-textarea" placeholder="Why are you entering this trade?"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" id="cancelOptionsBtn">Cancel</button>
                <button class="modal-btn primary" id="saveOptionsBtn">Save Position</button>
            </div>
        </div>
    </div>

        </main>

        <main id="cryptoShell" class="crypto-shell" hidden>

            <!-- Row 1: Bias Bar -->
            <section class="crypto-bias-bar" id="cryptoBiasBar">
                <div class="crypto-bias-row" id="cryptoBiasRow">
                    <div class="crypto-bias-inline" id="cryptoBiasInline">
                        <span class="bias-pill" data-bias="daily">Daily: <span id="cryptoBiasDaily">--</span></span>
                        <span class="bias-divider">|</span>
                        <span class="bias-pill" data-bias="composite">Market Composite: <span id="cryptoCompositeInline">NEUTRAL</span></span>
                    </div>
                    <div class="crypto-price-row" id="cryptoPriceRow">
                        <div class="crypto-price-extra" id="cryptoFundingInline">Funding: --</div>
                        <span class="price-divider">|</span>
                        <div class="crypto-price-cluster">
                            <div class="crypto-price-stack">
                                <span class="crypto-price-small" id="cryptoBinanceSpotInline" title="Binance spot">--</span>
                                <span class="crypto-price-sub">Binance Spot</span>
                            </div>
                            <span class="crypto-price-main" id="cryptoCoinbaseSpotInline" title="Coinbase spot">--</span>
                            <div class="crypto-price-stack">
                                <span class="crypto-price-small" id="cryptoBinancePerpInline" title="Perp (Binance primary, Bybit/OKX fallback)">--</span>
                                <span class="crypto-price-sub" id="cryptoPerpSourceInline">--</span>
                            </div>
                        </div>
                        <span class="price-divider">|</span>
                        <div class="crypto-price-extra" id="cryptoCvdInline">CVD: --</div>
                    </div>
                    <div class="crypto-bias-meta">
                        <div class="crypto-session-status compact" id="cryptoSessionStatus">
                            <span class="session-pill">Fetching BTC session</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Row 2: Chart + Trade Ideas + Positions -->
            <section class="crypto-main-content">
                <!-- TradingView Chart -->
                <div class="crypto-chart-area">
                    <div class="crypto-top-coins" id="cryptoTopCoins">
                        <button class="coin-chip active" data-symbol="BTCUSD">BTC</button>
                        <button class="coin-chip" data-symbol="ETHUSD">ETH</button>
                        <button class="coin-chip" data-symbol="BNBUSD">BNB</button>
                        <button class="coin-chip" data-symbol="XRPUSD">XRP</button>
                        <button class="coin-chip" data-symbol="ADAUSD">ADA</button>
                        <button class="coin-chip" data-symbol="DOGEUSD">DOGE</button>
                        <button class="coin-chip" data-symbol="SOLUSD">SOL</button>
                        <button class="coin-chip" data-symbol="AVAXUSD">AVAX</button>
                        <button class="coin-chip" data-symbol="LINKUSD">LINK</button>
                        <button class="coin-chip" data-symbol="MATICUSD">MATIC</button>
                        <button class="coin-chip" data-symbol="HYPEUSD">HYPE</button>
                        <button class="coin-chip" data-symbol="ASTRUSD">ASTR</button>
                    </div>
                    <div class="crypto-chart-container" id="cryptoChartContainer">
                        <div id="crypto-tradingview-widget"></div>
                    </div>
                    <!-- Key Levels Overlay -->
                    <div class="crypto-key-levels-strip" id="cryptoKeyLevelsStrip">
                        <span class="crypto-kl" data-level="todayOpen" title="Today Open">TO: <b>--</b></span>
                        <span class="crypto-kl" data-level="overnightHigh" title="Overnight High">OH: <b>--</b></span>
                        <span class="crypto-kl" data-level="overnightLow" title="Overnight Low">OL: <b>--</b></span>
                        <span class="crypto-kl" data-level="weeklyOpen" title="Weekly Open">WO: <b>--</b></span>
                        <span class="crypto-kl" data-level="monthlyOpen" title="Monthly Open">MO: <b>--</b></span>
                        <span class="crypto-kl-updated" id="cryptoKeyLevelsUpdated">--</span>
                    </div>
                    <!-- Order Flow / Tape -->
                    <div class="crypto-orderflow-panel">
                        <div class="crypto-orderflow-header">
                            <h3>Order Flow (Binance Perp)</h3>
                            <span class="orderflow-updated" id="cryptoOrderflowUpdated">--</span>
                        </div>
                        <div class="crypto-orderflow-body">
                            <div class="orderflow-metrics">
                                <div class="orderflow-metric">
                                    <span class="metric-label">Taker Buy</span>
                                    <span class="metric-value" id="cryptoTakerBuy">--</span>
                                </div>
                                <div class="orderflow-metric">
                                    <span class="metric-label">Taker Sell</span>
                                    <span class="metric-value" id="cryptoTakerSell">--</span>
                                </div>
                                <div class="orderflow-metric">
                                    <span class="metric-label">CVD Trend</span>
                                    <span class="metric-value" id="cryptoCvdTrend">--</span>
                                </div>
                            </div>
                            <div class="orderflow-chart" id="cryptoCvdSparkline"></div>
                            <div class="orderflow-tape" id="cryptoOrderflowTape">
                                <p class="empty-state">Waiting for tape‚Ä¶</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trade Ideas -->
                <div class="crypto-trades-panel">
                    <div class="crypto-panel-header">
                        <h2>TRADE IDEAS</h2>
                        <div class="crypto-panel-controls">
                            <label for="cryptoSignalSort" class="crypto-label">Sort</label>
                            <select id="cryptoSignalSort" class="crypto-select">
                                <option value="score">Score</option>
                                <option value="recency">Recency</option>
                            </select>
                        </div>
                    </div>
                    <div class="crypto-signal-list" id="cryptoSignalsList">
                        <p class="empty-state">No crypto signals yet</p>
                    </div>
                </div>

                <!-- Open Positions -->
                <div class="crypto-positions-panel">
                    <div class="crypto-panel-header">
                        <h2>OPEN POSITIONS</h2>
                        <div class="positions-header-actions">
                            <button class="add-position-btn" id="addCryptoPositionBtn" data-action="add-manual-position" data-context="crypto" title="Add Breakout Trade">+</button>
                            <span class="positions-count" id="cryptoPositionsCount">0</span>
                        </div>
                    </div>
                    <div class="crypto-positions-list" id="cryptoPositionsList">
                        <p class="empty-state">No open crypto positions</p>
                    </div>
                </div>
                <div class="crypto-btc-signals-panel compact inline">
                    <div class="btc-signals-header">
                        <h2>BTC BOTTOM SIGNALS</h2>
                        <div class="btc-signals-controls">
                            <button class="btc-btn btc-refresh-btn" data-label="Refresh">Refresh</button>
                            <button class="btc-btn secondary btc-reset-btn">Reset</button>
                        </div>
                    </div>
                    <div class="btc-confluence-summary" id="cryptoBtcConfluenceSummary">
                        <div class="confluence-meter">
                            <span class="confluence-count">--</span>
                            <span class="confluence-label">Signals Firing</span>
                        </div>
                        <div class="confluence-verdict">Loading...</div>
                    </div>
                    <div class="btc-api-status" id="cryptoBtcApiStatus"></div>
                    <div class="btc-signals-grid compact" id="cryptoBtcSignalsGrid">
                        <p class="empty-state">Loading BTC signals...</p>
                    </div>
                </div>
            </section>

                        <!-- Row 3: Strategy Filters -->
            <section class="crypto-strategy-bottom">
                <div class="crypto-strategy-half">
                    <div class="crypto-strategy-section">
                        <div class="crypto-strategy-header">
                            <h2>STRATEGY FILTERS</h2>
                            <div class="crypto-strategy-controls">
                                <label class="direction-toggle">
                                    <input type="checkbox" id="cryptoFilterLong" checked>
                                    <span class="direction-label long">LONG</span>
                                </label>
                                <label class="direction-toggle">
                                    <input type="checkbox" id="cryptoFilterShort" checked>
                                    <span class="direction-label short">SHORT</span>
                                </label>
                                <label class="direction-toggle auto-bias-toggle">
                                    <input type="checkbox" id="cryptoAutoBiasToggle" checked>
                                    <span class="direction-label neutral">AUTO BIAS</span>
                                </label>
                                <span class="header-divider">|</span>
                                <label class="min-score-label">Min Score:</label>
                                <input type="number" id="cryptoScoreThreshold" class="score-input" min="1" max="100" value="1">
                            </div>
                        </div>
                        <div class="crypto-strategy-toggles" id="cryptoStrategyToggles">
                            <label class="strategy-toggle">
                                <input type="checkbox" class="crypto-strategy-cb" data-strategy="scout" checked data-direction="LONG">
                                <span class="strategy-name">Scout (15m Early)</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="crypto-strategy-cb" data-strategy="sniper" checked data-direction="LONG">
                                <span class="strategy-name">Sniper (1H Confirm)</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="crypto-strategy-cb" data-strategy="exhaustion" checked>
                                <span class="strategy-name">Exhaustion</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="crypto-strategy-cb" data-strategy="triple_line" checked>
                                <span class="strategy-name">Triple Line</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="crypto-strategy-cb" data-strategy="golden_touch" checked>
                                <span class="strategy-name">Golden Touch</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="crypto-strategy-cb" data-strategy="pullback_entry" checked>
                                <span class="strategy-name">Pullback Entry</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="crypto-strategy-cb" data-strategy="taurus_signal" checked>
                                <span class="strategy-name">Taurus Signal</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="crypto-strategy-cb" data-strategy="ursa_signal" checked>
                                <span class="strategy-name">Ursa Signal</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="crypto-strategy-cb" data-strategy="two_close_vol" checked>
                                <span class="strategy-name">Two-Close + Vol</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="crypto-strategy-cb" data-strategy="zone_upgrade" checked>
                                <span class="strategy-name">Zone Upgrade</span>
                            </label>
                        </div>
                    </div>
                </div>
            </section>

        </main>

    <!-- Knowledgebase Popup Modal -->
    <div class="modal-overlay" id="kbPopupModal">
        <div class="kb-popup-modal">
            <div class="kb-popup-header">
                <span class="kb-popup-category" id="kbPopupCategory">Category</span>
                <h2 class="kb-popup-title" id="kbPopupTitle">Term</h2>
                <button class="modal-close" id="closeKbPopupBtn">‚úï</button>
            </div>
            <div class="kb-popup-body" id="kbPopupBody">
                <!-- Short description loaded here -->
            </div>
            <div class="kb-popup-footer">
                <div class="kb-popup-related" id="kbPopupRelated">
                    <!-- Related terms shown here -->
                </div>
                <a href="#" class="kb-more-info-link" id="kbMoreInfoLink" target="_blank">
                    MORE INFORMATION ‚Üí
                </a>
            </div>
        </div>
    </div>

    <!-- TradingView Widget Script -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script src="/app.js?v=53"></script>
</body>
</html>




