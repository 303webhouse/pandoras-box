<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Pandora's Box - Real-time Trading Signal Dashboard">
    <title>Pandora's Box</title>
    <link rel="stylesheet" href="styles.css?v=24">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a0e27">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <h1 class="logo">üì¶ PANDORA'S BOX</h1>
                <div class="connection-status" id="connectionStatus">
                    <span class="status-dot"></span>
                    <span class="status-text">Connecting...</span>
                </div>
            </div>
            <div class="header-controls">
                <!-- Savita Update Reminder (shows when stale) -->
                <div class="savita-reminder" id="savitaReminder" style="display: none;">
                    <span class="reminder-icon">üìä</span>
                    <a href="#" id="savitaUpdateLink" class="reminder-link">Update Savita</a>
                </div>
                <button class="refresh-btn" id="refreshBtn">‚Üª Refresh</button>
            </div>
        </header>

        <!-- Bias Indicators -->
        <section class="bias-section">
            <!-- Hierarchical flow indicator with personal bias controls -->
            <div class="bias-hierarchy-flow">
                <span class="hierarchy-label">Bias Flow:</span>
                <span class="hierarchy-arrow">Cyclical</span>
                <span class="hierarchy-connector">‚Üí</span>
                <span class="hierarchy-arrow">Weekly</span>
                <span class="hierarchy-connector">‚Üí</span>
                <span class="hierarchy-arrow">Daily</span>
                
                <div class="bias-flow-divider"></div>
                
                <!-- Alignment Indicator -->
                <div class="bias-alignment-indicator" id="biasAlignmentIndicator">
                    <span class="alignment-icon">‚ö°</span>
                    <span class="alignment-text" id="alignmentText">ALIGNED</span>
                </div>
                
                <div class="bias-flow-divider"></div>
                
                <!-- Personal Bias Selector -->
                <div class="personal-bias-control">
                    <label class="personal-bias-label">My Bias:</label>
                    <select id="personalBiasSelector" class="personal-bias-select">
                        <option value="NEUTRAL">Neutral</option>
                        <option value="TORO">Toro (+1)</option>
                        <option value="URSA">Ursa (-1)</option>
                    </select>
                </div>
                
                <!-- Override Control -->
                <div class="bias-override-control">
                    <label class="override-label">Override:</label>
                    <button class="override-toggle" id="biasOverrideToggle" data-active="false">OFF</button>
                    <select id="overrideDirectionSelector" class="override-direction-select" disabled>
                        <option value="MAJOR_TORO">MAJOR TORO</option>
                        <option value="MAJOR_URSA">MAJOR URSA</option>
                    </select>
                </div>
            </div>
            
            <!-- Override Active Banner -->
            <div class="override-active-banner" id="overrideActiveBanner">
                ‚ö° OVERRIDE ACTIVE: <span id="overrideBiasDisplay">TORO MAJOR</span> - All calculated biases ignored
            </div>
            
            <!-- Crisis Mode Alert Banner -->
            <div class="crisis-alert-banner" id="crisisAlertBanner" style="display: none;">
                <span class="crisis-icon">üö®</span>
                <span class="crisis-text">CRISIS TIER ACTIVE: </span>
                <span class="crisis-factors" id="crisisFactors">Sahm Rule triggered</span>
                <span class="crisis-note"> - Elevated weighting applied</span>
            </div>
            
            <div class="bias-card" id="dailyBias">
                <h3>Daily Bias</h3>
                <button class="bias-settings-btn" id="dailyBiasSettingsBtn" title="Factor Settings">‚öôÔ∏è</button>
                <div class="bias-display">
                    <div class="bias-level" id="dailyLevel">NEUTRAL</div>
                    <div class="bias-effective" id="dailyEffective" style="display: none;">
                        <span class="effective-label">Effective:</span>
                        <span class="effective-level"></span>
                    </div>
                    <div class="bias-details" id="dailyDetails">Loading...</div>
                </div>
            </div>
            <div class="bias-card" id="weeklyBias">
                <h3>Weekly Bias</h3>
                <button class="bias-settings-btn" id="weeklyBiasSettingsBtn" title="Factor Settings">‚öôÔ∏è</button>
                <div class="bias-display">
                    <div class="bias-level" id="weeklyLevel">NEUTRAL</div>
                    <div class="bias-effective" id="weeklyEffective" style="display: none;">
                        <span class="effective-label">Effective:</span>
                        <span class="effective-level"></span>
                    </div>
                    <div class="bias-details" id="weeklyDetails">Loading...</div>
                </div>
            </div>
            <div class="bias-card" id="cyclicalBias">
                <h3>Cyclical Bias</h3>
                <button class="bias-settings-btn" id="cyclicalBiasSettingsBtn" title="Factor Settings">‚öôÔ∏è</button>
                <div class="bias-display">
                    <div class="bias-level" id="cyclicalLevel">NEUTRAL</div>
                    <div class="bias-details" id="cyclicalDetails">Loading...</div>
                </div>
            </div>
        </section>

        <!-- Main Content: Chart + Trade Ideas + Open Positions -->
        <section class="main-content">
            <!-- Chart Area (1/2 width) -->
            <div class="chart-area">
                <div class="chart-tabs" id="chartTabs">
                    <button class="chart-tab active" data-symbol="SPY">SPY</button>
                    <button class="chart-tab" data-symbol="VIX">VIX</button>
                    <button class="chart-tab" data-symbol="BTCUSD">BTC</button>
                </div>
                <div class="chart-container" id="chartContainer">
                    <!-- TradingView Widget -->
                    <div id="tradingview-widget"></div>
                </div>
            </div>

            <!-- Trade Ideas (1/4 width) -->
            <div class="trades-panel">
                <div class="trades-header">
                    <h2>TRADE IDEAS</h2>
                    <div class="asset-toggle">
                        <button class="toggle-btn active" data-asset="equity">Equities</button>
                        <button class="toggle-btn" data-asset="crypto">Crypto</button>
                    </div>
                </div>
                <div class="signals-container" id="tradeSignals">
                    <!-- Signals will be populated by JavaScript -->
                    <p class="empty-state">No signals available</p>
                </div>
            </div>

            <!-- Open Positions (1/4 width) -->
            <div class="positions-panel">
                <div class="positions-header">
                    <h2>OPEN POSITIONS</h2>
                    <span class="positions-count" id="positionsCount">0</span>
                </div>
                <div class="positions-container" id="openPositions">
                    <p class="empty-state">No open positions</p>
                </div>
            </div>
        </section>

        <!-- Watchlist & Single Ticker Scanner -->
        <section class="watchlist-section">
            <div class="watchlist-container">
                <div class="watchlist-header">
                    <h2>üìã MY WATCHLIST</h2>
                    <span class="watchlist-count" id="watchlistCount">0</span>
                </div>
                <div class="watchlist-controls">
                    <div class="watchlist-input-group">
                        <input type="text" id="addTickerInput" class="watchlist-input" placeholder="Add ticker (e.g. AAPL)">
                        <button class="watchlist-btn add" id="addTickerBtn">+ Add</button>
                    </div>
                </div>
                <div class="watchlist-tickers" id="watchlistTickers">
                    <p class="empty-state">Loading watchlist...</p>
                </div>
                <div class="watchlist-actions">
                    <button class="watchlist-btn secondary" id="resetWatchlistBtn">Reset to Defaults</button>
                </div>
            </div>
            
            <div class="ticker-analyzer">
                <div class="analyzer-header">
                    <h2>üî¨ SINGLE TICKER ANALYZER</h2>
                </div>
                <div class="analyzer-controls">
                    <div class="analyzer-input-group">
                        <input type="text" id="analyzeTickerInput" class="analyzer-input" placeholder="Enter ticker to analyze">
                        <button class="analyzer-btn" id="analyzeTickerBtn">Analyze</button>
                    </div>
                </div>
                <div class="analyzer-results" id="analyzerResults">
                    <p class="empty-state">Enter a ticker to see Hunter criteria breakdown</p>
                </div>
            </div>
        </section>

        <!-- CTA Scanner Results (Equity Swing Trading) -->
        <section class="cta-section">
            <div class="cta-header">
                <h2>üéØ CTA SCANNER (Equity Swing)</h2>
                <div class="cta-controls">
                    <button class="cta-btn" id="runCtaScanBtn">Run Scan</button>
                    <span class="scan-status" id="ctaScanStatus">Ready</span>
                </div>
            </div>
            <p class="cta-info">CTA Replication Strategy ‚Ä¢ 20/50/120 SMAs ‚Ä¢ Watchlist + S&P 500</p>
            
            <!-- CTA Zone Dashboard -->
            <div class="cta-zones-dashboard">
                <h3>üìä CTA Zone Dashboard</h3>
                <div class="cta-zone-cards" id="ctaZoneCards">
                    <div class="cta-zone-card" data-ticker="SPY">
                        <span class="zone-ticker">SPY</span>
                        <span class="zone-status loading">Loading...</span>
                    </div>
                </div>
            </div>
            
            <!-- CTA Signal Results -->
            <div class="cta-results">
                <div class="cta-column golden-column">
                    <div class="cta-column-header">
                        <h3>üåü GOLDEN TOUCH</h3>
                        <span class="signal-count" id="goldenCount">0</span>
                    </div>
                    <div class="cta-signals" id="goldenSignals">
                        <p class="empty-state">Rare: 120 SMA first touch</p>
                    </div>
                </div>
                <div class="cta-column twoclose-column">
                    <div class="cta-column-header">
                        <h3>‚úÖ TWO-CLOSE + VOL</h3>
                        <span class="signal-count" id="twoCloseCount">0</span>
                    </div>
                    <div class="cta-signals" id="twoCloseSignals">
                        <p class="empty-state">No confirmed breakouts</p>
                    </div>
                </div>
                <div class="cta-column pullback-column">
                    <div class="cta-column-header">
                        <h3>‚Ü©Ô∏è PULLBACK ENTRY</h3>
                        <span class="signal-count" id="pullbackCount">0</span>
                    </div>
                    <div class="cta-signals" id="pullbackSignals">
                        <p class="empty-state">No pullbacks to 20 SMA</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Hybrid Market Scanner (Technical + Fundamental) -->
        <section class="hybrid-scanner-section">
            <div class="hybrid-header">
                <h2>üì° HYBRID SCANNER</h2>
                <div class="hybrid-controls">
                    <input type="text" id="hybridTickerInput" class="hybrid-input" placeholder="Enter ticker (e.g., NVDA)">
                    <button class="hybrid-btn" id="hybridAnalyzeBtn">Analyze</button>
                    <button class="hybrid-btn secondary" id="runHybridScanBtn">Scan Top 10</button>
                </div>
            </div>
            <p class="hybrid-info">Technical (TradingView) + Fundamental (Wall Street Analysts) ‚Ä¢ Two-Gauge System</p>
            
            <!-- Single Ticker Analysis -->
            <div class="hybrid-analysis" id="hybridAnalysis">
                <div class="hybrid-gauges">
                    <!-- Technical Gauge -->
                    <div class="gauge-card technical-gauge" id="technicalGauge">
                        <h3>üìä Technical Gauge</h3>
                        <div class="gauge-signal" id="techSignal">--</div>
                        <div class="gauge-score" id="techScore">
                            <span class="buy-count">-- Buy</span> / 
                            <span class="sell-count">-- Sell</span>
                        </div>
                        <div class="gauge-details" id="techDetails">
                            <div>Oscillators: <span id="techOsc">--</span></div>
                            <div>Moving Avgs: <span id="techMA">--</span></div>
                        </div>
                    </div>
                    
                    <!-- Analyst Gauge -->
                    <div class="gauge-card analyst-gauge" id="analystGauge">
                        <h3>üè¶ Analyst Gauge</h3>
                        <div class="gauge-signal" id="analystSignal">--</div>
                        <div class="gauge-score" id="analystScore">
                            <span class="analyst-count">-- analysts</span>
                        </div>
                        <div class="gauge-details" id="analystDetails">
                            <div>Price Target: <span id="priceTarget">$--</span></div>
                            <div>Upside: <span id="analystUpside">--%</span></div>
                        </div>
                    </div>
                    
                    <!-- Combined Recommendation -->
                    <div class="gauge-card combined-gauge" id="combinedGauge">
                        <h3>‚ö° Combined</h3>
                        <div class="gauge-signal" id="combinedSignal">--</div>
                        <div class="gauge-score" id="combinedScore">Score: --/5</div>
                        <div class="gauge-details" id="tickerMeta">
                            <div id="tickerName">Enter ticker above</div>
                            <div id="tickerSector">--</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Scan Results Table -->
            <div class="hybrid-results" id="hybridResults" style="display: none;">
                <h3>üìã Scan Results</h3>
                <table class="hybrid-table">
                    <thead>
                        <tr>
                            <th>Ticker</th>
                            <th>Technical</th>
                            <th>Strength</th>
                            <th>Analyst</th>
                            <th>Upside</th>
                            <th>Sector</th>
                        </tr>
                    </thead>
                    <tbody id="hybridTableBody">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- BTC Bottom Signals Checklist -->
        <section class="btc-signals-section">
            <div class="btc-signals-header">
                <h2>‚Çø BTC BOTTOM SIGNALS</h2>
                <div class="btc-signals-controls">
                    <button class="btc-btn" id="refreshBtcSignalsBtn">‚Üª Refresh</button>
                    <button class="btc-btn secondary" id="resetBtcSignalsBtn">Reset All</button>
                </div>
            </div>
            <p class="btc-info">"We identify structural exhaustion of sellers and reset of leverage"</p>
            
            <!-- Confluence Summary -->
            <div class="btc-confluence-summary" id="btcConfluenceSummary">
                <div class="confluence-meter">
                    <span class="confluence-count">0/9</span>
                    <span class="confluence-label">Signals Firing</span>
                </div>
                <div class="confluence-verdict">Checking signals...</div>
            </div>
            
            <!-- Signal Checklist -->
            <div class="btc-signals-grid" id="btcSignalsGrid">
                <p class="empty-state">Loading signals...</p>
            </div>
            
            <!-- BTC Session Windows -->
            <div class="btc-sessions">
                <h3>‚è∞ BTC Trading Sessions (ET)</h3>
                <div class="btc-session-current" id="btcSessionCurrent">
                    <span class="session-status">Checking...</span>
                </div>
                <div class="btc-session-list" id="btcSessionList">
                    <!-- Sessions will be populated by JS -->
                </div>
            </div>
        </section>

        <!-- Options Flow (Unusual Whales) -->
        <section class="flow-section">
            <div class="flow-header">
                <h2>üêã OPTIONS FLOW</h2>
                <div class="flow-controls">
                    <button class="flow-btn" id="refreshFlowBtn">‚Üª Refresh</button>
                    <span class="flow-status" id="flowStatus">Not Connected</span>
                </div>
            </div>
            <p class="flow-info">Unusual Whales integration ‚Ä¢ Manual entry available ‚Ä¢ Auto-confirms CTA signals</p>
            
            <!-- Hot Tickers -->
            <div class="flow-hot-tickers">
                <h3>üî• Hot Flow</h3>
                <div class="flow-hot-list" id="flowHotList">
                    <p class="empty-state">No flow data yet</p>
                </div>
            </div>
            
            <!-- Recent Alerts -->
            <div class="flow-recent">
                <h3>üìä Recent Alerts</h3>
                <div class="flow-alerts-list" id="flowAlertsList">
                    <p class="empty-state">No recent alerts</p>
                </div>
            </div>
            
            <!-- Manual Entry Button -->
            <div class="flow-manual-entry">
                <button class="flow-btn add full-width" id="openFlowModalBtn">‚ûï Add Flow Observation</button>
            </div>
        </section>

        <!-- Flow Entry Modal -->
        <div class="modal-overlay" id="flowModalOverlay">
            <div class="flow-modal">
                <div class="flow-modal-header">
                    <h2>üêã Add Flow Observation</h2>
                    <button class="modal-close" id="closeFlowModalBtn">‚úï</button>
                </div>
                
                <!-- Notability Score -->
                <div class="flow-score-display" id="flowScoreDisplay">
                    <div class="flow-score-circle" id="flowScoreCircle">
                        <span class="flow-score-value" id="flowScoreValue">0</span>
                    </div>
                    <div class="flow-score-label" id="flowScoreLabel">Fill in details below</div>
                </div>
                
                <div class="flow-modal-body">
                    <!-- Ticker -->
                    <div class="flow-field">
                        <label>Ticker Symbol *</label>
                        <input type="text" id="modalFlowTicker" placeholder="e.g. NVDA" class="flow-modal-input">
                    </div>
                    
                    <!-- Direction -->
                    <div class="flow-field">
                        <label>Direction *</label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="sentiment" data-value="BULLISH">üü¢ Calls (Bullish)</button>
                            <button class="flow-option-btn" data-field="sentiment" data-value="BEARISH">üî¥ Puts (Bearish)</button>
                        </div>
                    </div>
                    
                    <!-- Flow Type -->
                    <div class="flow-field">
                        <label>Flow Type * <span class="field-hint">(Sweeps = most aggressive)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="type" data-value="SWEEP">üî• Sweep</button>
                            <button class="flow-option-btn" data-field="type" data-value="BLOCK">üì¶ Block</button>
                            <button class="flow-option-btn" data-field="type" data-value="UNUSUAL_VOLUME">üìä Unusual Vol</button>
                            <button class="flow-option-btn" data-field="type" data-value="DARK_POOL">üåë Dark Pool</button>
                        </div>
                    </div>
                    
                    <!-- Premium -->
                    <div class="flow-field">
                        <label>Premium Size * <span class="field-hint">(Total $ of the trade)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="premium" data-value="25000">$25K-$50K</button>
                            <button class="flow-option-btn" data-field="premium" data-value="75000">$50K-$100K</button>
                            <button class="flow-option-btn" data-field="premium" data-value="150000">$100K-$250K</button>
                            <button class="flow-option-btn" data-field="premium" data-value="500000">$250K+</button>
                        </div>
                    </div>
                    
                    <!-- Expiry -->
                    <div class="flow-field">
                        <label>Expiry Timeframe <span class="field-hint">(How soon do contracts expire?)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="expiry" data-value="0dte">0DTE</button>
                            <button class="flow-option-btn" data-field="expiry" data-value="week">This Week</button>
                            <button class="flow-option-btn" data-field="expiry" data-value="2-4weeks">2-4 Weeks</button>
                            <button class="flow-option-btn" data-field="expiry" data-value="monthly">Monthly+</button>
                            <button class="flow-option-btn" data-field="expiry" data-value="leaps">LEAPS (6mo+)</button>
                        </div>
                    </div>
                    
                    <!-- Volume vs OI -->
                    <div class="flow-field">
                        <label>Volume vs Open Interest <span class="field-hint">(Is volume unusually high?)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="voloi" data-value="low">Vol < OI</button>
                            <button class="flow-option-btn" data-field="voloi" data-value="normal">Vol ‚âà OI</button>
                            <button class="flow-option-btn" data-field="voloi" data-value="high">Vol > OI</button>
                            <button class="flow-option-btn" data-field="voloi" data-value="extreme">Vol >> OI (5x+)</button>
                        </div>
                    </div>
                    
                    <!-- Repeat Activity -->
                    <div class="flow-field">
                        <label>Repeat Activity? <span class="field-hint">(Same strike getting hit multiple times?)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="repeat" data-value="no">Single Trade</button>
                            <button class="flow-option-btn" data-field="repeat" data-value="yes">Multiple Hits</button>
                        </div>
                    </div>
                    
                    <!-- Notes -->
                    <div class="flow-field">
                        <label>Notes (optional)</label>
                        <input type="text" id="modalFlowNotes" placeholder="e.g. Before earnings, unusual timing..." class="flow-modal-input">
                    </div>
                </div>
                
                <div class="flow-modal-footer">
                    <div class="flow-verdict" id="flowVerdict">
                        <!-- Verdict will appear here -->
                    </div>
                    <button class="flow-btn cancel" id="cancelFlowBtn">Cancel</button>
                    <button class="flow-btn add" id="submitFlowBtn" disabled>Add Flow</button>
                </div>
            </div>
        </div>

        <!-- Strategy Controls -->
        <section class="strategies-section">
            <div class="strategies-header">
                <h2>‚öôÔ∏è STRATEGY CONTROLS</h2>
                <div class="strategies-actions">
                    <button class="strategy-btn-small enable-all" id="enableAllBtn">Enable All</button>
                    <button class="strategy-btn-small disable-all" id="disableAllBtn">Disable All</button>
                </div>
            </div>
            <div class="strategies-grid" id="strategiesGrid">
                <!-- Strategies will be populated by JavaScript -->
                <p class="empty-state">Loading strategies...</p>
            </div>
        </section>

        <!-- Position Entry Modal -->
        <div class="modal-overlay" id="positionEntryModal">
            <div class="position-modal">
                <div class="position-modal-header">
                    <h2>üìà Open Position</h2>
                    <button class="modal-close" id="closePositionModalBtn">‚úï</button>
                </div>
                <div class="position-modal-body">
                    <div class="position-ticker-display" id="positionTickerDisplay">AAPL</div>
                    <div class="position-direction-display" id="positionDirectionDisplay">LONG</div>
                    
                    <div class="position-field">
                        <label>Entry Price *</label>
                        <input type="number" id="positionEntryPrice" step="0.01" placeholder="e.g. 228.50" class="position-input">
                    </div>
                    
                    <div class="position-field">
                        <label id="positionQtyLabel">Quantity (Shares) *</label>
                        <input type="number" id="positionQuantity" step="1" placeholder="e.g. 100" class="position-input">
                    </div>
                    
                    <div class="position-summary" id="positionSummary">
                        <div class="summary-row">
                            <span>Stop Loss:</span>
                            <span id="summaryStop">--</span>
                        </div>
                        <div class="summary-row">
                            <span>Target:</span>
                            <span id="summaryTarget">--</span>
                        </div>
                        <div class="summary-row">
                            <span>Position Size:</span>
                            <span id="summarySize">$--</span>
                        </div>
                        <div class="summary-row">
                            <span>Risk Amount:</span>
                            <span id="summaryRisk">$--</span>
                        </div>
                    </div>
                </div>
                <div class="position-modal-footer">
                    <button class="position-btn cancel" id="cancelPositionBtn">Cancel</button>
                    <button class="position-btn confirm" id="confirmPositionBtn">Open Position</button>
                </div>
            </div>
        </div>

        <!-- Position Close Modal -->
        <div class="modal-overlay" id="positionCloseModal">
            <div class="position-modal">
                <div class="position-modal-header">
                    <h2>üìâ Close Position</h2>
                    <button class="modal-close" id="closeCloseModalBtn">‚úï</button>
                </div>
                <div class="position-modal-body">
                    <div class="position-ticker-display" id="closeTickerDisplay">AAPL</div>
                    
                    <div class="position-field">
                        <label>Exit Price *</label>
                        <input type="number" id="positionExitPrice" step="0.01" placeholder="e.g. 235.00" class="position-input">
                    </div>
                    
                    <div class="position-field">
                        <label id="closeQtyLabel">Quantity to Close *</label>
                        <input type="number" id="closeQuantity" step="1" placeholder="e.g. 50" class="position-input">
                        <small class="qty-hint" id="closeQtyHint">You have 100 shares</small>
                    </div>
                    
                    <div class="position-summary" id="closeSummary">
                        <div class="summary-row">
                            <span>Entry Price:</span>
                            <span id="closeEntryPrice">--</span>
                        </div>
                        <div class="summary-row pnl-row">
                            <span>Realized P&L:</span>
                            <span id="closeRealizedPnL">$--</span>
                        </div>
                    </div>
                </div>
                <div class="position-modal-footer">
                    <button class="position-btn cancel" id="cancelCloseBtn">Cancel</button>
                    <button class="position-btn confirm" id="confirmCloseBtn">Close Position</button>
                </div>
            </div>
        </div>

        <!-- Weekly Bias Factor Settings Modal -->
        <div class="modal-overlay" id="weeklyBiasSettingsModal">
            <div class="factors-modal">
                <div class="factors-modal-header">
                    <h2>Weekly Bias Factors</h2>
                    <button class="modal-close" id="closeWeeklyBiasSettingsBtn">‚úï</button>
                </div>
                <div class="factors-modal-body">
                    <div class="factor-toggle" data-factor="index_trends">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Index Trends (SPY/QQQ/IWM/SMH)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="dollar_trend">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Dollar Trend (DXY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="sector_rotation">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Sector Rotation (XLK vs XLU)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="credit_spreads">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Credit Spreads (HYG vs TLT)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="market_breadth">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Market Breadth (RSP vs SPY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="vix_term_structure">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">VIX Term Structure</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-divider"></div>
                    <div class="factor-toggle personal-bias-toggle" data-timeframe="weekly">
                        <label>
                            <input type="checkbox" id="weeklyPersonalBiasToggle" checked>
                            <span class="factor-name">Apply My Personal Bias</span>
                        </label>
                        <span class="factor-note">(adjusts score by +/-1)</span>
                    </div>
                </div>
                <div class="factors-modal-footer">
                    <button class="factors-btn reset" id="resetFactorsBtn">Reset All</button>
                    <button class="factors-btn apply" id="applyFactorsBtn">Apply</button>
                </div>
            </div>
        </div>

        <!-- Daily Bias Factor Settings Modal -->
        <div class="modal-overlay" id="dailyBiasSettingsModal">
            <div class="factors-modal">
                <div class="factors-modal-header">
                    <h2>Daily Bias Factors</h2>
                    <button class="modal-close" id="closeDailyBiasSettingsBtn">‚úï</button>
                </div>
                <div class="factors-modal-body">
                    <div class="factor-toggle" data-factor="spy_rsi">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">SPY RSI (Momentum)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="vix_level">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">VIX Level (Fear)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="tech_leadership">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Tech Leadership (QQQ vs SPY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="small_cap_risk">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Small Cap Risk (IWM vs SPY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="spy_trend">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">SPY Trend</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="market_breadth">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Market Breadth (RSP vs SPY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-divider"></div>
                    <div class="factor-toggle personal-bias-toggle" data-timeframe="daily">
                        <label>
                            <input type="checkbox" id="dailyPersonalBiasToggle" checked>
                            <span class="factor-name">Apply My Personal Bias</span>
                        </label>
                        <span class="factor-note">(adjusts score by +/-1)</span>
                    </div>
                </div>
                <div class="factors-modal-footer">
                    <button class="factors-btn reset" id="resetDailyFactorsBtn">Reset All</button>
                    <button class="factors-btn apply" id="applyDailyFactorsBtn">Apply</button>
                </div>
            </div>
        </div>

        <!-- Cyclical Bias Factor Settings Modal -->
        <div class="modal-overlay" id="cyclicalBiasSettingsModal">
            <div class="factors-modal">
                <div class="factors-modal-header">
                    <h2>Cyclical Bias Factors</h2>
                    <button class="modal-close" id="closeCyclicalBiasSettingsBtn">‚úï</button>
                </div>
                <div class="factors-modal-body">
                    <div class="factor-toggle" data-factor="sma_200_positions">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">200 SMA Positions</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="yield_curve">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Yield Curve</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="credit_spreads">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Credit Spreads</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="savita_indicator">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Savita Indicator</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="longterm_breadth">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Long-term Breadth</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="sahm_rule">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name">Sahm Rule</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-divider"></div>
                    <div class="factor-toggle personal-bias-toggle" data-timeframe="cyclical">
                        <label>
                            <input type="checkbox" id="cyclicalPersonalBiasToggle" checked>
                            <span class="factor-name">Apply My Personal Bias</span>
                        </label>
                        <span class="factor-note">(adjusts score by +/-1)</span>
                    </div>
                </div>
                <div class="factors-modal-footer">
                    <button class="factors-btn reset" id="resetCyclicalFactorsBtn">Reset All</button>
                    <button class="factors-btn apply" id="applyCyclicalFactorsBtn">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Savita Update Modal -->
    <div class="modal-overlay" id="savitaUpdateModal">
        <div class="savita-modal">
            <div class="savita-modal-header">
                <h2>Update Savita Indicator</h2>
                <button class="modal-close" id="closeSavitaModal">‚úï</button>
            </div>
            <div class="savita-modal-body">
                <p class="savita-description">
                    Enter the latest BofA Sell Side Indicator reading from financial news.
                    <br><small>Search: "BofA Sell Side Indicator" or "Savita Subramanian indicator"</small>
                </p>
                <div class="savita-input-group">
                    <label for="savitaReading">Reading (%)</label>
                    <input type="number" id="savitaReading" min="40" max="70" step="0.1" placeholder="e.g., 55.9">
                </div>
                <div class="savita-input-group">
                    <label for="savitaDate">Report Date (optional)</label>
                    <input type="date" id="savitaDate">
                </div>
                <div class="savita-current" id="savitaCurrentInfo">
                    Current: <span id="savitaCurrentReading">--</span>% (updated <span id="savitaLastUpdated">--</span>)
                </div>
            </div>
            <div class="savita-modal-footer">
                <button class="savita-btn cancel" id="cancelSavitaUpdate">Cancel</button>
                <button class="savita-btn submit" id="submitSavitaUpdate">Update</button>
            </div>
        </div>
    </div>

    <!-- TradingView Widget Script -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script src="app.js?v=28"></script>
</body>
</html>
