<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Pandora's Box - Real-time Trading Signal Dashboard">
    <title>Pandora's Box</title>
    <link rel="stylesheet" href="styles.css?v=28">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a0e27">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <h1 class="logo">üì¶ PANDORA'S BOX</h1>
                <div class="connection-status" id="connectionStatus">
                    <span class="status-dot"></span>
                    <span class="status-text">Connecting...</span>
                </div>
            </div>
            <div class="header-controls">
                <a href="/knowledgebase" class="kb-btn" title="Knowledgebase">üìö KB</a>
                <button class="refresh-btn" id="refreshBtn">‚Üª Refresh</button>
            </div>
        </header>

        <!-- Bias Indicators -->
        <section class="bias-section">
            <!-- Hierarchical flow indicator with personal bias controls -->
            <div class="bias-hierarchy-flow">
                <span class="hierarchy-label">Bias Flow:</span>
                <span class="hierarchy-arrow">Cyclical</span>
                <span class="hierarchy-connector">‚Üí</span>
                <span class="hierarchy-arrow">Weekly</span>
                <span class="hierarchy-connector">‚Üí</span>
                <span class="hierarchy-arrow">Daily</span>
                
                <div class="bias-flow-divider"></div>
                
                <!-- Alignment Indicator -->
                <div class="bias-alignment-indicator" id="biasAlignmentIndicator">
                    <span class="alignment-icon">‚ö°</span>
                    <span class="alignment-text" id="alignmentText">ALIGNED</span>
                </div>
                
                <div class="bias-flow-divider"></div>
                
                <!-- Personal Bias Selector -->
                <div class="personal-bias-control">
                    <label class="personal-bias-label">My Bias:</label>
                    <select id="personalBiasSelector" class="personal-bias-select">
                        <option value="NEUTRAL">Neutral</option>
                        <option value="TORO">Toro (+1)</option>
                        <option value="URSA">Ursa (-1)</option>
                    </select>
                </div>
                
                <!-- Override Control -->
                <div class="bias-override-control">
                    <label class="override-label">Override:</label>
                    <button class="override-toggle" id="biasOverrideToggle" data-active="false">OFF</button>
                    <select id="overrideDirectionSelector" class="override-direction-select" disabled>
                        <option value="MAJOR_TORO">MAJOR TORO</option>
                        <option value="MAJOR_URSA">MAJOR URSA</option>
                    </select>
                </div>
                
                <!-- Savita Update Button -->
                <button class="savita-update-btn" id="savitaUpdateBtn" title="Update Savita Indicator">
                    üìä Savita
                </button>
            </div>
            
            <!-- Override Active Banner -->
            <div class="override-active-banner" id="overrideActiveBanner">
                ‚ö° OVERRIDE ACTIVE: <span id="overrideBiasDisplay">TORO MAJOR</span> - All calculated biases ignored
            </div>
            
            <!-- Crisis Mode Alert Banner -->
            <div class="crisis-alert-banner" id="crisisAlertBanner" style="display: none;">
                <span class="crisis-icon">üö®</span>
                <span class="crisis-text">CRISIS TIER ACTIVE: </span>
                <span class="crisis-factors" id="crisisFactors">Sahm Rule triggered</span>
                <span class="crisis-note"> - Elevated weighting applied</span>
            </div>
            
            <div class="bias-card" id="dailyBias">
                <h3><span class="kb-link" data-kb-term="daily-bias">Daily Bias</span></h3>
                <button class="bias-settings-btn" id="dailyBiasSettingsBtn" title="Factor Settings">‚öôÔ∏è</button>
                <div class="bias-display">
                    <div class="bias-level" id="dailyLevel">NEUTRAL</div>
                    <div class="bias-effective" id="dailyEffective" style="display: none;">
                        <span class="effective-label"><span class="kb-link" data-kb-term="effective-bias">Effective</span>:</span>
                        <span class="effective-level"></span>
                    </div>
                    <div class="bias-details" id="dailyDetails">Loading...</div>
                </div>
            </div>
            <div class="bias-card" id="weeklyBias">
                <h3><span class="kb-link" data-kb-term="weekly-bias">Weekly Bias</span></h3>
                <button class="bias-settings-btn" id="weeklyBiasSettingsBtn" title="Factor Settings">‚öôÔ∏è</button>
                <div class="bias-display">
                    <div class="bias-level" id="weeklyLevel">NEUTRAL</div>
                    <div class="bias-effective" id="weeklyEffective" style="display: none;">
                        <span class="effective-label"><span class="kb-link" data-kb-term="effective-bias">Effective</span>:</span>
                        <span class="effective-level"></span>
                    </div>
                    <div class="bias-details" id="weeklyDetails">Loading...</div>
                </div>
            </div>
            <div class="bias-card" id="cyclicalBias">
                <h3><span class="kb-link" data-kb-term="cyclical-bias">Cyclical Bias</span></h3>
                <button class="bias-settings-btn" id="cyclicalBiasSettingsBtn" title="Factor Settings">‚öôÔ∏è</button>
                <div class="bias-display">
                    <div class="bias-level" id="cyclicalLevel">NEUTRAL</div>
                    <div class="bias-details" id="cyclicalDetails">Loading...</div>
                </div>
            </div>
        </section>

        <!-- Main Content: Chart + Trade Ideas + Open Positions -->
        <section class="main-content">
            <!-- Chart Area (1/2 width) -->
            <div class="chart-area">
                <div class="chart-tabs" id="chartTabs">
                    <button class="chart-tab active" data-symbol="SPY">SPY</button>
                    <button class="chart-tab" data-symbol="VIX">VIX</button>
                    <button class="chart-tab" data-symbol="BTCUSD">BTC</button>
                </div>
                <div class="chart-container" id="chartContainer">
                    <!-- TradingView Widget -->
                    <div id="tradingview-widget"></div>
                </div>
                
                <!-- Price Levels Panel (shows entry/stop/target for open positions) -->
                <div class="price-levels-panel" id="priceLevelsPanel" style="display: none;">
                    <div class="price-levels-header">
                        <span class="price-levels-ticker" id="priceLevelsTicker">--</span>
                        <span class="price-levels-label">LEVELS</span>
                    </div>
                    <div class="price-levels-content">
                        <div class="price-level entry">
                            <span class="level-label">Entry</span>
                            <span class="level-value" id="priceLevelEntry">--</span>
                        </div>
                        <div class="price-level stop">
                            <span class="level-label">Stop</span>
                            <span class="level-value" id="priceLevelStop">--</span>
                        </div>
                        <div class="price-level target">
                            <span class="level-label">Target 1</span>
                            <span class="level-value" id="priceLevelTarget1">--</span>
                        </div>
                        <div class="price-level target2" id="priceLevelTarget2Row" style="display: none;">
                            <span class="level-label">Target 2</span>
                            <span class="level-value" id="priceLevelTarget2">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trade Ideas (1/4 width) -->
            <div class="trades-panel">
                <div class="trades-header">
                    <h2><span class="kb-link" data-kb-term="trade-ideas">TRADE IDEAS</span></h2>
                    <div class="asset-toggle">
                        <button class="toggle-btn active" data-asset="equity">Equities</button>
                        <button class="toggle-btn" data-asset="options">Options</button>
                    </div>
                </div>
                <!-- Equity Signals Container -->
                <div class="signals-container" id="tradeSignals">
                    <!-- Signals will be populated by JavaScript -->
                    <p class="empty-state">No signals available</p>
                </div>
                <!-- Options Tab Content -->
                <div class="options-tab-content" id="optionsTabContent" style="display: none;">
                    <div class="options-header">
                        <h3>Open Options Positions</h3>
                        <button class="options-btn primary" id="openOptionsModalBtn">+ Add Position</button>
                    </div>
                    <!-- Options Summary -->
                    <div class="options-summary" id="optionsSummary">
                        <div class="summary-stat">
                            <span class="stat-label">Open Positions</span>
                            <span class="stat-value" id="optionsCount">0</span>
                        </div>
                        <div class="summary-stat">
                            <span class="stat-label">Total P&L</span>
                            <span class="stat-value" id="optionsTotalPnl">$0.00</span>
                        </div>
                        <div class="summary-stat">
                            <span class="stat-label">Net Delta</span>
                            <span class="stat-value" id="optionsNetDelta">0</span>
                        </div>
                        <div class="summary-stat">
                            <span class="stat-label">Daily Theta</span>
                            <span class="stat-value" id="optionsDailyTheta">$0.00</span>
                        </div>
                    </div>
                    <!-- Options Positions List -->
                    <div class="options-positions-list" id="optionsPositionsList">
                        <p class="empty-state">No open options positions</p>
                    </div>
                </div>
            </div>

            <!-- Open Positions (1/4 width) -->
            <div class="positions-panel">
                <div class="positions-header">
                    <h2>OPEN POSITIONS</h2>
                    <div class="positions-header-actions">
                        <button class="add-position-btn" id="addPositionBtn" title="Add Manual Trade">+</button>
                        <span class="positions-count" id="positionsCount">0</span>
                    </div>
                </div>
                <div class="positions-container" id="openPositions">
                    <p class="empty-state">No open positions</p>
                </div>
            </div>
        </section>

        <!-- Watchlist & Single Ticker Scanner -->
        <section class="watchlist-section">
            <div class="watchlist-container">
                <div class="watchlist-header">
                    <h2>üìã MY WATCHLIST</h2>
                    <span class="watchlist-count" id="watchlistCount">0</span>
                </div>
                <div class="watchlist-controls">
                    <div class="watchlist-input-group">
                        <input type="text" id="addTickerInput" class="watchlist-input" placeholder="Add ticker (e.g. AAPL)">
                        <button class="watchlist-btn add" id="addTickerBtn">+ Add</button>
                    </div>
                </div>
                <div class="watchlist-tickers" id="watchlistTickers">
                    <p class="empty-state">Loading watchlist...</p>
                </div>
                <div class="watchlist-actions">
                    <button class="watchlist-btn secondary" id="resetWatchlistBtn">Reset to Defaults</button>
                </div>
            </div>
            
            <div class="ticker-analyzer">
                <div class="analyzer-header">
                    <h2>üî¨ SINGLE TICKER ANALYZER</h2>
                </div>
                <div class="analyzer-controls">
                    <div class="analyzer-input-group">
                        <input type="text" id="analyzeTickerInput" class="analyzer-input" placeholder="Enter ticker to analyze">
                        <button class="analyzer-btn" id="analyzeTickerBtn">Analyze</button>
                    </div>
                </div>
                
                <!-- Aggregate Verdict with Bias Alignment -->
                <div class="analyzer-aggregate" id="analyzerAggregate" style="display: none;">
                    <div class="aggregate-verdict" id="aggregateVerdict">
                        <span class="aggregate-ticker" id="aggregateTicker">--</span>
                        <span class="aggregate-signal" id="aggregateSignal">--</span>
                    </div>
                    <div class="aggregate-details">
                        <div class="aggregate-score" id="aggregateScore">Score: --</div>
                        <div class="aggregate-alignment" id="aggregateAlignment">
                            <span class="alignment-label">vs Daily Bias:</span>
                            <span class="alignment-status" id="biasAlignmentStatus">--</span>
                        </div>
                    </div>
                </div>
                
                <!-- Ticker Info & Metrics -->
                <div class="analyzer-results" id="analyzerResults">
                    <p class="empty-state">Enter a ticker to analyze</p>
                </div>
                
                <!-- Gauges (Technical + Analyst) - Below Info Boxes -->
                <div class="analyzer-gauges" id="analyzerGauges" style="display: none;">
                    <div class="gauge-card technical-gauge" id="technicalGauge">
                        <h3>üìä Technical</h3>
                        <div class="gauge-signal" id="techSignal">--</div>
                        <div class="gauge-score" id="techScore">
                            <span class="buy-count">-- Buy</span> /
                            <span class="sell-count">-- Sell</span>
                        </div>
                        <div class="gauge-details" id="techDetails">
                            <div>Oscillators: <span id="techOsc">--</span></div>
                            <div>Moving Avgs: <span id="techMA">--</span></div>
                        </div>
                    </div>
                    <div class="gauge-card analyst-gauge" id="analystGauge">
                        <h3>üè¶ Analyst</h3>
                        <div class="gauge-signal" id="analystSignal">--</div>
                        <div class="gauge-score" id="analystScore">
                            <span class="analyst-count">-- analysts</span>
                        </div>
                        <div class="gauge-details" id="analystDetails">
                            <div>Target: <span id="priceTarget">$--</span></div>
                            <div>Upside: <span id="analystUpside">--%</span></div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Context Cards -->
                <div class="analyzer-context" id="analyzerContext" style="display: none;">
                    <!-- CTA Zone Card -->
                    <div class="context-card cta-zone-card">
                        <h3>üìä CTA Zone</h3>
                        <div class="zone-status" id="contextZoneStatus">
                            <span class="zone-label">--</span>
                        </div>
                        <div class="zone-smas" id="contextZoneSMAs">
                            <div class="sma-row">
                                <span class="sma-label">20 SMA:</span>
                                <span class="sma-value" id="sma20">--</span>
                            </div>
                            <div class="sma-row">
                                <span class="sma-label">50 SMA:</span>
                                <span class="sma-value" id="sma50">--</span>
                            </div>
                            <div class="sma-row">
                                <span class="sma-label">120 SMA:</span>
                                <span class="sma-value" id="sma120">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Sector Info Card -->
                    <div class="context-card sector-card">
                        <h3>üè¢ Sector Info</h3>
                        <div class="sector-info" id="contextSectorInfo">
                            <div class="info-row">
                                <span class="info-label">Sector:</span>
                                <span class="info-value" id="sectorName">--</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">ETF:</span>
                                <span class="info-value" id="sectorETF">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Bias Alignment Card -->
                    <div class="context-card alignment-card">
                        <h3>‚öñÔ∏è Bias Alignment</h3>
                        <div class="alignment-info" id="contextAlignmentInfo">
                            <div class="alignment-row">
                                <span class="alignment-label">LONG trades:</span>
                                <span class="alignment-status" id="longAlignment">--</span>
                            </div>
                            <div class="alignment-row">
                                <span class="alignment-label">SHORT trades:</span>
                                <span class="alignment-status" id="shortAlignment">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Levels Card -->
                    <div class="context-card risk-card">
                        <h3>‚ö†Ô∏è Risk Levels</h3>
                        <div class="risk-info" id="contextRiskInfo">
                            <div class="risk-row">
                                <span class="risk-label">ATR:</span>
                                <span class="risk-value" id="atrValue">--</span>
                            </div>
                            <div class="risk-row">
                                <span class="risk-label">Stop (2x ATR):</span>
                                <span class="risk-value" id="stopDistance">--</span>
                            </div>
                            <div class="risk-row">
                                <span class="risk-label">Target (3x ATR):</span>
                                <span class="risk-value" id="targetDistance">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Flow Card -->
                    <div class="context-card flow-card">
                        <h3>üêã Recent Flow (24h)</h3>
                        <div class="flow-summary" id="contextFlowSummary">
                            <p class="flow-empty">No recent flow data</p>
                        </div>
                    </div>

                    <!-- Recent Signals Card -->
                    <div class="context-card signals-card">
                        <h3>üì° Recent Signals (24h)</h3>
                        <div class="signals-summary" id="contextSignalsSummary">
                            <p class="signals-empty">No recent signals</p>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="analyzer-actions">
                        <button class="analyzer-action-btn create-idea" id="createTradeIdeaBtn">
                            üìù Create Trade Idea
                        </button>
                        <button class="analyzer-action-btn add-watchlist" id="addToWatchlistBtn">
                            ‚≠ê Add to Watchlist
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Strategy Filter Panel -->
        <section class="strategy-filter-section">
            <div class="strategy-filter-header">
                <h2><span class="icon-teal">&#9881;</span> STRATEGY FILTERS</h2>
                <span class="header-divider">|</span>
                <div class="header-controls">
                    <label class="direction-toggle">
                        <input type="checkbox" id="filterLong" checked>
                        <span class="direction-label long">LONG</span>
                    </label>
                    <label class="direction-toggle">
                        <input type="checkbox" id="filterShort" checked>
                        <span class="direction-label short">SHORT</span>
                    </label>
                    <span class="header-divider">|</span>
                    <label class="min-score-label">Min Score:</label>
                    <input type="number" id="scoreThreshold" class="score-input" min="1" max="100" value="1">
                    <span class="header-divider">|</span>
                    <span class="filter-status"><span id="activeStrategyCount">10</span> strategies, <span id="activeDirections">LONG + SHORT</span>, min <span id="activeMinScore">1</span></span>
                </div>
                <div class="strategy-filter-controls">
                    <button class="filter-btn select-all" id="selectAllStrategies">Select All</button>
                    <button class="filter-btn clear-all" id="clearAllStrategies">Clear All</button>
                </div>
            </div>

            <!-- Strategy Groups (scrollable) -->
            <div class="strategy-groups-container">
                <div class="strategy-groups">
                    <!-- Trend Following -->
                    <div class="strategy-group">
                        <h3 class="strategy-group-title"><span class="icon-teal">&#8593;</span> Trend Following</h3>
                        <div class="strategy-toggles">
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="golden_touch" checked>
                                <span class="strategy-name">Golden Touch</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="pullback_entry" checked>
                                <span class="strategy-name">Pullback Entry</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="taurus_signal" checked>
                                <span class="strategy-name">Taurus Signal</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="triple_line" checked>
                                <span class="strategy-name">Triple Line</span>
                            </label>
                        </div>
                    </div>

                    <!-- Breakout -->
                    <div class="strategy-group">
                        <h3 class="strategy-group-title"><span class="icon-teal">&#9650;</span> Breakout</h3>
                        <div class="strategy-toggles">
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="two_close_vol" checked>
                                <span class="strategy-name">Two-Close + Vol</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="zone_upgrade" checked>
                                <span class="strategy-name">Zone Upgrade</span>
                            </label>
                        </div>
                    </div>

                    <!-- Reversal -->
                    <div class="strategy-group">
                        <h3 class="strategy-group-title"><span class="icon-teal">&#8635;</span> Reversal</h3>
                        <div class="strategy-toggles">
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="exhaustion" checked>
                                <span class="strategy-name">Exhaustion</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="ursa_signal" checked>
                                <span class="strategy-name">Ursa Signal</span>
                            </label>
                        </div>
                    </div>

                    <!-- Macro Confluence -->
                    <div class="strategy-group">
                        <h3 class="strategy-group-title"><span class="icon-teal">&#9673;</span> Macro Confluence</h3>
                        <div class="strategy-toggles">
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="apis_call" checked>
                                <span class="strategy-name">APIS Call</span>
                            </label>
                            <label class="strategy-toggle">
                                <input type="checkbox" class="strategy-checkbox" data-strategy="kodiak_call" checked>
                                <span class="strategy-name">Kodiak Call</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

        </section>

        <!-- Hybrid Market Scanner (Batch Scan Results) -->
        <section class="hybrid-scanner-section">
            <div class="hybrid-header">
                <h2>üì° <span class="kb-link" data-kb-term="hybrid-scanner">HYBRID BATCH SCANNER</span></h2>
                <div class="hybrid-controls">
                    <button class="hybrid-btn" id="runHybridScanBtn">Scan Watchlist</button>
                </div>
            </div>
            <p class="hybrid-info">Scans your watchlist with Technical + Analyst analysis</p>
            
            <!-- Scan Results Table -->
            <div class="hybrid-results" id="hybridResults" style="display: none;">
                <h3>üìã Scan Results</h3>
                <table class="hybrid-table">
                    <thead>
                        <tr>
                            <th>Ticker</th>
                            <th>Technical</th>
                            <th>Strength</th>
                            <th>Analyst</th>
                            <th>Upside</th>
                            <th>Sector</th>
                        </tr>
                    </thead>
                    <tbody id="hybridTableBody">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- BTC Bottom Signals Checklist -->
        <section class="btc-signals-section">
            <div class="btc-signals-header">
                <h2>‚Çø <span class="kb-link" data-kb-term="btc-bottom-signals">BTC BOTTOM SIGNALS</span></h2>
                <div class="btc-signals-controls">
                    <button class="btc-btn" id="refreshBtcSignalsBtn">‚Üª Refresh</button>
                    <button class="btc-btn secondary" id="resetBtcSignalsBtn">Reset All</button>
                </div>
            </div>
            <p class="btc-info">"We identify structural exhaustion of sellers and reset of leverage"</p>
            
            <!-- Confluence Summary -->
            <div class="btc-confluence-summary" id="btcConfluenceSummary">
                <div class="confluence-meter">
                    <span class="confluence-count">0/9</span>
                    <span class="confluence-label kb-link" data-kb-term="macro-confluence">Signals Firing</span>
                </div>
                <div class="confluence-verdict">Checking signals...</div>
            </div>
            
            <!-- API Status -->
            <div class="btc-api-status" id="btcApiStatus">
                <span class="api-status-item">Loading APIs...</span>
            </div>
            
            <!-- Signal Checklist (ALL 9 AUTOMATED) -->
            <div class="btc-signals-grid" id="btcSignalsGrid">
                <p class="empty-state">Loading signals...</p>
            </div>
            
            <!-- BTC Session Windows -->
            <!-- MOVED TO CRYPTO-SCALPER: This section has been relocated to the dedicated crypto-scalper application -->
            <!--
            <div class="btc-sessions">
                <h3>‚è∞ BTC Trading Sessions (ET)</h3>
                <div class="btc-session-current" id="btcSessionCurrent">
                    <span class="session-status">Checking...</span>
                </div>
                <div class="btc-session-list" id="btcSessionList">
                    <!-- Sessions will be populated by JS -->
                </div>
            </div>
            -->
        </section>

        <!-- Options Flow (Unusual Whales) -->
        <section class="flow-section">
            <div class="flow-header">
                <h2>üêã OPTIONS FLOW</h2>
                <div class="flow-controls">
                    <button class="flow-btn" id="refreshFlowBtn">‚Üª Refresh</button>
                    <span class="flow-status" id="flowStatus">Not Connected</span>
                </div>
            </div>
            <p class="flow-info">Unusual Whales integration ‚Ä¢ Manual entry available ‚Ä¢ Auto-confirms CTA signals</p>
            
            <!-- Hot Tickers -->
            <div class="flow-hot-tickers">
                <h3>üî• Hot Flow</h3>
                <div class="flow-hot-list" id="flowHotList">
                    <p class="empty-state">No flow data yet</p>
                </div>
            </div>
            
            <!-- Recent Alerts -->
            <div class="flow-recent">
                <h3>üìä Recent Alerts</h3>
                <div class="flow-alerts-list" id="flowAlertsList">
                    <p class="empty-state">No recent alerts</p>
                </div>
            </div>
            
            <!-- Manual Entry Button -->
            <div class="flow-manual-entry">
                <button class="flow-btn add full-width" id="openFlowModalBtn">‚ûï Add Flow Observation</button>
            </div>
        </section>

        <!-- Flow Entry Modal -->
        <div class="modal-overlay" id="flowModalOverlay">
            <div class="flow-modal">
                <div class="flow-modal-header">
                    <h2>üêã Add Flow Observation</h2>
                    <button class="modal-close" id="closeFlowModalBtn">‚úï</button>
                </div>
                
                <!-- Notability Score -->
                <div class="flow-score-display" id="flowScoreDisplay">
                    <div class="flow-score-circle" id="flowScoreCircle">
                        <span class="flow-score-value" id="flowScoreValue">0</span>
                    </div>
                    <div class="flow-score-label" id="flowScoreLabel">Fill in details below</div>
                </div>
                
                <div class="flow-modal-body">
                    <!-- Ticker -->
                    <div class="flow-field">
                        <label>Ticker Symbol *</label>
                        <input type="text" id="modalFlowTicker" placeholder="e.g. NVDA" class="flow-modal-input">
                    </div>
                    
                    <!-- Direction -->
                    <div class="flow-field">
                        <label>Direction *</label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="sentiment" data-value="BULLISH">üü¢ Calls (Bullish)</button>
                            <button class="flow-option-btn" data-field="sentiment" data-value="BEARISH">üî¥ Puts (Bearish)</button>
                        </div>
                    </div>
                    
                    <!-- Flow Type -->
                    <div class="flow-field">
                        <label>Flow Type * <span class="field-hint">(Sweeps = most aggressive)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="type" data-value="SWEEP">üî• Sweep</button>
                            <button class="flow-option-btn" data-field="type" data-value="BLOCK">üì¶ Block</button>
                            <button class="flow-option-btn" data-field="type" data-value="UNUSUAL_VOLUME">üìä Unusual Vol</button>
                            <button class="flow-option-btn" data-field="type" data-value="DARK_POOL">üåë Dark Pool</button>
                        </div>
                    </div>
                    
                    <!-- Premium -->
                    <div class="flow-field">
                        <label>Premium Size * <span class="field-hint">(Total $ of the trade)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="premium" data-value="25000">$25K-$50K</button>
                            <button class="flow-option-btn" data-field="premium" data-value="75000">$50K-$100K</button>
                            <button class="flow-option-btn" data-field="premium" data-value="150000">$100K-$250K</button>
                            <button class="flow-option-btn" data-field="premium" data-value="500000">$250K+</button>
                        </div>
                    </div>
                    
                    <!-- Expiry -->
                    <div class="flow-field">
                        <label>Expiry Timeframe <span class="field-hint">(How soon do contracts expire?)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="expiry" data-value="0dte">0DTE</button>
                            <button class="flow-option-btn" data-field="expiry" data-value="week">This Week</button>
                            <button class="flow-option-btn" data-field="expiry" data-value="2-4weeks">2-4 Weeks</button>
                            <button class="flow-option-btn" data-field="expiry" data-value="monthly">Monthly+</button>
                            <button class="flow-option-btn" data-field="expiry" data-value="leaps">LEAPS (6mo+)</button>
                        </div>
                    </div>
                    
                    <!-- Volume vs OI -->
                    <div class="flow-field">
                        <label>Volume vs Open Interest <span class="field-hint">(Is volume unusually high?)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="voloi" data-value="low">Vol < OI</button>
                            <button class="flow-option-btn" data-field="voloi" data-value="normal">Vol ‚âà OI</button>
                            <button class="flow-option-btn" data-field="voloi" data-value="high">Vol > OI</button>
                            <button class="flow-option-btn" data-field="voloi" data-value="extreme">Vol >> OI (5x+)</button>
                        </div>
                    </div>
                    
                    <!-- Repeat Activity -->
                    <div class="flow-field">
                        <label>Repeat Activity? <span class="field-hint">(Same strike getting hit multiple times?)</span></label>
                        <div class="flow-btn-group">
                            <button class="flow-option-btn" data-field="repeat" data-value="no">Single Trade</button>
                            <button class="flow-option-btn" data-field="repeat" data-value="yes">Multiple Hits</button>
                        </div>
                    </div>
                    
                    <!-- Notes -->
                    <div class="flow-field">
                        <label>Notes (optional)</label>
                        <input type="text" id="modalFlowNotes" placeholder="e.g. Before earnings, unusual timing..." class="flow-modal-input">
                    </div>
                </div>
                
                <div class="flow-modal-footer">
                    <div class="flow-verdict" id="flowVerdict">
                        <!-- Verdict will appear here -->
                    </div>
                    <button class="flow-btn cancel" id="cancelFlowBtn">Cancel</button>
                    <button class="flow-btn add" id="submitFlowBtn" disabled>Add Flow</button>
                </div>
            </div>
        </div>

        <!-- Strategy Controls -->
        <section class="strategies-section">
            <div class="strategies-header">
                <h2>‚öôÔ∏è STRATEGY CONTROLS</h2>
                <div class="strategies-actions">
                    <button class="strategy-btn-small enable-all" id="enableAllBtn">Enable All</button>
                    <button class="strategy-btn-small disable-all" id="disableAllBtn">Disable All</button>
                </div>
            </div>
            <div class="strategies-grid" id="strategiesGrid">
                <!-- Strategies will be populated by JavaScript -->
                <p class="empty-state">Loading strategies...</p>
            </div>
        </section>

        <!-- Position Entry Modal -->
        <div class="modal-overlay" id="positionEntryModal">
            <div class="position-modal">
                <div class="position-modal-header">
                    <h2>üìà Open Position</h2>
                    <button class="modal-close" id="closePositionModalBtn">‚úï</button>
                </div>
                <div class="position-modal-body">
                    <div class="position-ticker-display" id="positionTickerDisplay">AAPL</div>
                    <div class="position-direction-display" id="positionDirectionDisplay">LONG</div>
                    
                    <div class="position-field">
                        <label>Entry Price *</label>
                        <input type="number" id="positionEntryPrice" step="0.01" placeholder="e.g. 228.50" class="position-input">
                    </div>
                    
                    <div class="position-field">
                        <label id="positionQtyLabel">Quantity (Shares) *</label>
                        <input type="number" id="positionQuantity" step="1" placeholder="e.g. 100" class="position-input">
                    </div>
                    
                    <div class="position-summary" id="positionSummary">
                        <div class="summary-row">
                            <span>Stop Loss:</span>
                            <span id="summaryStop">--</span>
                        </div>
                        <div class="summary-row">
                            <span>Target:</span>
                            <span id="summaryTarget">--</span>
                        </div>
                        <div class="summary-row">
                            <span>Position Size:</span>
                            <span id="summarySize">$--</span>
                        </div>
                        <div class="summary-row">
                            <span>Risk Amount:</span>
                            <span id="summaryRisk">$--</span>
                        </div>
                    </div>
                </div>
                <div class="position-modal-footer">
                    <button class="position-btn cancel" id="cancelPositionBtn">Cancel</button>
                    <button class="position-btn confirm" id="confirmPositionBtn">Open Position</button>
                </div>
            </div>
        </div>

        <!-- Position Close Modal -->
        <div class="modal-overlay" id="positionCloseModal">
            <div class="position-modal">
                <div class="position-modal-header">
                    <h2>üìâ Close Position</h2>
                    <button class="modal-close" id="closeCloseModalBtn">‚úï</button>
                </div>
                <div class="position-modal-body">
                    <div class="position-ticker-display" id="closeTickerDisplay">AAPL</div>
                    
                    <div class="position-field">
                        <label>Exit Price *</label>
                        <input type="number" id="positionExitPrice" step="0.01" placeholder="e.g. 235.00" class="position-input">
                    </div>
                    
                    <div class="position-field">
                        <label id="closeQtyLabel">Quantity to Close *</label>
                        <input type="number" id="closeQuantity" step="1" placeholder="e.g. 50" class="position-input">
                        <small class="qty-hint" id="closeQtyHint">You have 100 shares</small>
                    </div>
                    
                    <div class="position-summary" id="closeSummary">
                        <div class="summary-row">
                            <span>Entry Price:</span>
                            <span id="closeEntryPrice">--</span>
                        </div>
                        <div class="summary-row pnl-row">
                            <span>Realized P&L:</span>
                            <span id="closeRealizedPnL">$--</span>
                        </div>
                    </div>
                </div>
                <div class="position-modal-footer">
                    <button class="position-btn cancel" id="cancelCloseBtn">Cancel</button>
                    <button class="position-btn confirm" id="confirmCloseBtn">Close Position</button>
                </div>
            </div>
        </div>

        <!-- Weekly Bias Factor Settings Modal -->
        <div class="modal-overlay" id="weeklyBiasSettingsModal">
            <div class="factors-modal">
                <div class="factors-modal-header">
                    <h2>Weekly Bias Factors</h2>
                    <button class="modal-close" id="closeWeeklyBiasSettingsBtn">‚úï</button>
                </div>
                <div class="factors-modal-body">
                    <div class="factor-toggle" data-factor="index_trends">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="weekly-bias">Index Trends (SPY/QQQ/IWM/SMH)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="dollar_trend">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="dollar-smile">Dollar Trend (DXY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="sector_rotation">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="sector-rotation">Sector Rotation (XLK vs XLU)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="credit_spreads">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="credit-spreads">Credit Spreads (HYG vs TLT)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="market_breadth">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="market-breadth">Market Breadth (RSP vs SPY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="vix_term_structure">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="vix-term-structure">VIX Term Structure</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-divider"></div>
                    <div class="factor-toggle personal-bias-toggle" data-timeframe="weekly">
                        <label>
                            <input type="checkbox" id="weeklyPersonalBiasToggle" checked>
                            <span class="factor-name">Apply My Personal Bias</span>
                        </label>
                        <span class="factor-note">(adjusts score by +/-1)</span>
                    </div>
                </div>
                <div class="factors-modal-footer">
                    <button class="factors-btn reset" id="resetFactorsBtn">Reset All</button>
                    <button class="factors-btn apply" id="applyFactorsBtn">Apply</button>
                </div>
            </div>
        </div>

        <!-- Daily Bias Factor Settings Modal -->
        <div class="modal-overlay" id="dailyBiasSettingsModal">
            <div class="factors-modal">
                <div class="factors-modal-header">
                    <h2>Daily Bias Factors</h2>
                    <button class="modal-close" id="closeDailyBiasSettingsBtn">‚úï</button>
                </div>
                <div class="factors-modal-body">
                    <div class="factor-toggle" data-factor="spy_rsi">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="rsi">SPY RSI (Momentum)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="vix_level">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="vix-term-structure">VIX Level (Fear)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="tech_leadership">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="daily-bias">Tech Leadership (QQQ vs SPY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="small_cap_risk">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="daily-bias">Small Cap Risk (IWM vs SPY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="spy_trend">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="daily-bias">SPY Trend</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="market_breadth">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="market-breadth">Market Breadth (RSP vs SPY)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="tick_breadth">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="tick-breadth">TICK Range Breadth</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-divider"></div>
                    <div class="factor-toggle personal-bias-toggle" data-timeframe="daily">
                        <label>
                            <input type="checkbox" id="dailyPersonalBiasToggle" checked>
                            <span class="factor-name">Apply My Personal Bias</span>
                        </label>
                        <span class="factor-note">(adjusts score by +/-1)</span>
                    </div>
                </div>
                <div class="factors-modal-footer">
                    <button class="factors-btn reset" id="resetDailyFactorsBtn">Reset All</button>
                    <button class="factors-btn apply" id="applyDailyFactorsBtn">Apply</button>
                </div>
            </div>
        </div>

        <!-- Cyclical Bias Factor Settings Modal -->
        <div class="modal-overlay" id="cyclicalBiasSettingsModal">
            <div class="factors-modal">
                <div class="factors-modal-header">
                    <h2>Cyclical Bias Factors</h2>
                    <button class="modal-close" id="closeCyclicalBiasSettingsBtn">‚úï</button>
                </div>
                <div class="factors-modal-body">
                    <div class="factor-toggle" data-factor="sma_200_positions">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="cyclical-bias">200 SMA Positions</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="yield_curve">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="cyclical-bias">Yield Curve</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="credit_spreads">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="credit-spreads">Credit Spreads</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="excess_cape_yield">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="excess-cape-yield">Excess CAPE Yield</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="savita_indicator" style="opacity: 0.6;">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="savita-indicator">Savita (Optional)</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="longterm_breadth">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="market-breadth">Long-term Breadth</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-toggle" data-factor="sahm_rule">
                        <label>
                            <input type="checkbox" checked>
                            <span class="factor-name kb-factor-link" data-kb-term="cyclical-bias">Sahm Rule</span>
                        </label>
                        <span class="factor-vote" data-vote="0">(vote: 0)</span>
                    </div>
                    <div class="factor-divider"></div>
                    <div class="factor-toggle personal-bias-toggle" data-timeframe="cyclical">
                        <label>
                            <input type="checkbox" id="cyclicalPersonalBiasToggle" checked>
                            <span class="factor-name">Apply My Personal Bias</span>
                        </label>
                        <span class="factor-note">(adjusts score by +/-1)</span>
                    </div>
                </div>
                <div class="factors-modal-footer">
                    <button class="factors-btn reset" id="resetCyclicalFactorsBtn">Reset All</button>
                    <button class="factors-btn apply" id="applyCyclicalFactorsBtn">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Savita Update Modal -->
    <div class="modal-overlay" id="savitaUpdateModal">
        <div class="savita-modal">
            <div class="savita-modal-header">
                <h2>Update Savita Indicator</h2>
                <button class="modal-close" id="closeSavitaModal">‚úï</button>
            </div>
            <div class="savita-modal-body">
                <p class="savita-description">
                    Enter the latest BofA Sell Side Indicator reading from financial news.
                    <br><small>Search: "BofA Sell Side Indicator" or "Savita Subramanian indicator"</small>
                </p>
                <div class="savita-input-group">
                    <label for="savitaReading">Reading (%)</label>
                    <input type="number" id="savitaReading" min="40" max="70" step="0.1" placeholder="e.g., 55.9">
                </div>
                <div class="savita-input-group">
                    <label for="savitaDate">Report Date (optional)</label>
                    <input type="date" id="savitaDate">
                </div>
                <div class="savita-current" id="savitaCurrentInfo">
                    Current: <span id="savitaCurrentReading">--</span>% (updated <span id="savitaLastUpdated">--</span>)
                </div>
            </div>
            <div class="savita-modal-footer">
                <button class="savita-btn cancel" id="cancelSavitaUpdate">Cancel</button>
                <button class="savita-btn submit" id="submitSavitaUpdate">Update</button>
            </div>
        </div>
    </div>

    <!-- Manual Position Entry Modal -->
    <div class="modal-overlay" id="manualPositionModal">
        <div class="modal-content manual-position-modal">
            <div class="modal-header">
                <h3>Add Manual Position</h3>
                <button class="modal-close" id="closeManualPositionBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ticker</label>
                        <input type="text" id="manualTicker" placeholder="AAPL" maxlength="10">
                    </div>
                    <div class="form-group">
                        <label>Direction</label>
                        <select id="manualDirection">
                            <option value="LONG">LONG</option>
                            <option value="SHORT">SHORT</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Entry Price</label>
                        <input type="number" id="manualEntryPrice" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" id="manualQuantity" step="1" placeholder="100">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Stop Loss</label>
                        <input type="number" id="manualStopLoss" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Target</label>
                        <input type="number" id="manualTarget" step="0.01" placeholder="0.00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Strategy / Notes</label>
                        <input type="text" id="manualNotes" placeholder="Manual entry, swing trade, etc.">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelManualPositionBtn">Cancel</button>
                <button class="btn-confirm" id="confirmManualPositionBtn">Add Position</button>
            </div>
        </div>
    </div>

    <!-- Options Entry Modal -->
    <div class="modal-overlay" id="optionsModalOverlay" style="display: none;">
        <div class="options-modal">
            <div class="modal-header">
                <h2>Add Options Position</h2>
                <button class="modal-close" id="closeOptionsModalBtn">‚úï</button>
            </div>
            <div class="modal-body">
                <!-- Step 1: Basic Info -->
                <div class="form-section">
                    <h4>Position Details</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Underlying</label>
                            <input type="text" id="optUnderlying" placeholder="SPY" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label>Strategy</label>
                            <select id="optStrategy" class="form-select">
                                <option value="LONG_CALL">Long Call</option>
                                <option value="LONG_PUT">Long Put</option>
                                <option value="BULL_CALL_SPREAD">Bull Call Spread</option>
                                <option value="BEAR_PUT_SPREAD">Bear Put Spread</option>
                                <option value="BULL_PUT_SPREAD">Bull Put Spread (Credit)</option>
                                <option value="BEAR_CALL_SPREAD">Bear Call Spread (Credit)</option>
                                <option value="IRON_CONDOR">Iron Condor</option>
                                <option value="STRADDLE">Straddle</option>
                                <option value="STRANGLE">Strangle</option>
                                <option value="CUSTOM">Custom</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Direction</label>
                            <select id="optDirection" class="form-select">
                                <option value="BULLISH">Bullish</option>
                                <option value="BEARISH">Bearish</option>
                                <option value="NEUTRAL">Neutral</option>
                                <option value="VOLATILITY">Volatility</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- Step 2: Legs -->
                <div class="form-section">
                    <h4>Option Legs</h4>
                    <div class="legs-container" id="optLegsContainer">
                        <!-- Leg 1 (default) -->
                        <div class="leg-row" data-leg="1">
                            <div class="leg-header">
                                <span class="leg-number">Leg 1</span>
                            </div>
                            <div class="leg-fields">
                                <select class="leg-action form-select-sm">
                                    <option value="BUY">BUY</option>
                                    <option value="SELL">SELL</option>
                                </select>
                                <select class="leg-type form-select-sm">
                                    <option value="CALL">CALL</option>
                                    <option value="PUT">PUT</option>
                                </select>
                                <input type="number" class="leg-strike form-input-sm" placeholder="Strike" step="0.5">
                                <input type="date" class="leg-expiry form-input-sm">
                                <input type="number" class="leg-qty form-input-sm" placeholder="Qty" value="1" min="1">
                                <input type="number" class="leg-premium form-input-sm" placeholder="Premium" step="0.01">
                            </div>
                        </div>
                    </div>
                    <button class="add-leg-btn" id="addLegBtn">+ Add Leg</button>
                </div>
                <!-- Step 3: Position Metrics -->
                <div class="form-section">
                    <h4>Position Metrics</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Net Premium</label>
                            <input type="number" id="optNetPremium" placeholder="-250 or 150" class="form-input" step="0.01">
                            <span class="form-hint">Negative = debit, Positive = credit</span>
                        </div>
                        <div class="form-group">
                            <label>Max Profit</label>
                            <input type="number" id="optMaxProfit" placeholder="Optional" class="form-input" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Max Loss</label>
                            <input type="number" id="optMaxLoss" placeholder="Optional" class="form-input" step="0.01">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Breakeven</label>
                            <input type="text" id="optBreakeven" placeholder="585.50 or 580,590" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>Entry Date</label>
                            <input type="date" id="optEntryDate" class="form-input">
                        </div>
                    </div>
                </div>
                <!-- Step 4: Notes -->
                <div class="form-section">
                    <h4>Trade Thesis</h4>
                    <textarea id="optThesis" class="form-textarea" placeholder="Why are you entering this trade?"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" id="cancelOptionsBtn">Cancel</button>
                <button class="modal-btn primary" id="saveOptionsBtn">Save Position</button>
            </div>
        </div>
    </div>

    <!-- Knowledgebase Popup Modal -->
    <div class="modal-overlay" id="kbPopupModal">
        <div class="kb-popup-modal">
            <div class="kb-popup-header">
                <span class="kb-popup-category" id="kbPopupCategory">Category</span>
                <h2 class="kb-popup-title" id="kbPopupTitle">Term</h2>
                <button class="modal-close" id="closeKbPopupBtn">‚úï</button>
            </div>
            <div class="kb-popup-body" id="kbPopupBody">
                <!-- Short description loaded here -->
            </div>
            <div class="kb-popup-footer">
                <div class="kb-popup-related" id="kbPopupRelated">
                    <!-- Related terms shown here -->
                </div>
                <a href="#" class="kb-more-info-link" id="kbMoreInfoLink" target="_blank">
                    MORE INFORMATION ‚Üí
                </a>
            </div>
        </div>
    </div>

    <!-- TradingView Widget Script -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script src="app.js?v=42"></script>
</body>
</html>
