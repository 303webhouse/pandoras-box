//@version=5
indicator("Enhanced CTA + VWAP System (Ryan's Base + Swing Tweaks)", overlay=true, max_labels_count=500)

// ==========================================
// OVERVIEW:
// This indicator combines Ryan's AIO MAs + Rolling VWAPs with enhancements
// specifically for CTA-based swing trading:
// - 20/50/120 SMA structure for CTA zone detection
// - Background coloring showing current market regime
// - Volume confirmation for breakouts
// - 120 SMA "Golden Touch" detector
// - VWAP with standard deviation bands
// - Alerts for key transitions
// ==========================================

// ==========================================
// 1. INPUT SETTINGS
// ==========================================

// --- CTA SMA Settings (Primary for Swing Trading) ---
grp_cta = "CTA Strategy SMAs (20/50/120)"
show_cta_system = input.bool(true, "Enable CTA Zone System", group=grp_cta)
show_sma20 = input.bool(true, "SMA 20 (Fast)", group=grp_cta, inline="s20")
col_sma20 = input.color(#2196F3, "", group=grp_cta, inline="s20")
wid_sma20 = input.int(2, "Width", minval=1, maxval=5, group=grp_cta, inline="s20")

show_sma50 = input.bool(true, "SMA 50 (Core)", group=grp_cta, inline="s50")
col_sma50 = input.color(#FF9800, "", group=grp_cta, inline="s50")
wid_sma50 = input.int(2, "Width", minval=1, maxval=5, group=grp_cta, inline="s50")

show_sma120 = input.bool(true, "SMA 120 (Structural)", group=grp_cta, inline="s120")
col_sma120 = input.color(#F44336, "", group=grp_cta, inline="s120")
wid_sma120 = input.int(2, "Width", minval=1, maxval=5, group=grp_cta, inline="s120")

show_sma200 = input.bool(true, "SMA 200 (Long-term)", group=grp_cta, inline="s200")
col_sma200 = input.color(#795548, "", group=grp_cta, inline="s200")
wid_sma200 = input.int(1, "Width", minval=1, maxval=5, group=grp_cta, inline="s200")

// --- CTA Zone Background ---
grp_zone = "CTA Zone Visualization"
show_zone_bg = input.bool(true, "Show Zone Background Color", group=grp_zone)
show_zone_label = input.bool(true, "Show Zone Label", group=grp_zone)
zone_transparency = input.int(92, "Background Transparency", minval=80, maxval=98, group=grp_zone)
col_max_long = input.color(color.green, "Max Long Zone", group=grp_zone)
col_delever = input.color(color.yellow, "De-Leveraging Zone", group=grp_zone)
col_waterfall = input.color(color.orange, "Waterfall Zone", group=grp_zone)
col_capitulation = input.color(color.red, "Capitulation Zone", group=grp_zone)

// --- EMA Settings (Ryan's Original - for intraday reference) ---
grp_ema = "EMA Settings (Intraday Reference)"
show_ema1 = input.bool(false, "EMA 1", group=grp_ema, inline="e1")
len_ema1 = input.int(9, "Len", minval=1, group=grp_ema, inline="e1")
col_ema1 = input.color(#2962FF, "", group=grp_ema, inline="e1")
wid_ema1 = input.int(1, "Width", minval=1, group=grp_ema, inline="e1")

show_ema2 = input.bool(false, "EMA 2", group=grp_ema, inline="e2")
len_ema2 = input.int(21, "Len", minval=1, group=grp_ema, inline="e2")
col_ema2 = input.color(#AF52DE, "", group=grp_ema, inline="e2")
wid_ema2 = input.int(1, "Width", minval=1, group=grp_ema, inline="e2")

show_ema3 = input.bool(false, "EMA 3", group=grp_ema, inline="e3")
len_ema3 = input.int(55, "Len", minval=1, group=grp_ema, inline="e3")
col_ema3 = input.color(#FF9800, "", group=grp_ema, inline="e3")
wid_ema3 = input.int(1, "Width", minval=1, group=grp_ema, inline="e3")

// --- Volume Confirmation Settings ---
grp_vol = "Volume Confirmation"
show_vol_signals = input.bool(true, "Show Volume Breakout Signals", group=grp_vol)
vol_threshold = input.float(1.10, "Volume Threshold (1.10 = 10% above avg)", minval=1.0, maxval=2.0, step=0.05, group=grp_vol)
vol_avg_period = input.int(30, "Volume Average Period", minval=10, maxval=50, group=grp_vol)

// --- Golden Touch Settings (120 SMA First Touch) ---
grp_golden = "120 SMA Golden Touch"
show_golden_touch = input.bool(true, "Show Golden Touch Signals", group=grp_golden)
golden_min_bars = input.int(50, "Min Bars Above 120 Before Touch", minval=20, maxval=100, group=grp_golden)
golden_correction_pct = input.float(5.0, "Min Correction % from High", minval=3.0, maxval=10.0, step=0.5, group=grp_golden)

// --- Rolling VWAP Settings (Ryan's Original) ---
grp_vwap = "Rolling VWAP Settings (Days)"
show_vw1 = input.bool(false, "VWAP 1", group=grp_vwap, inline="v1")
day_vw1 = input.float(2, "Days", minval=0.1, step=0.5, group=grp_vwap, inline="v1")
col_vw1 = input.color(color.new(#B2B5BE, 0), "", group=grp_vwap, inline="v1")
wid_vw1 = input.int(1, "Width", minval=1, group=grp_vwap, inline="v1")

show_vw2 = input.bool(false, "VWAP 2", group=grp_vwap, inline="v2")
day_vw2 = input.float(3, "Days", minval=0.1, step=0.5, group=grp_vwap, inline="v2")
col_vw2 = input.color(color.new(#5d606b, 0), "", group=grp_vwap, inline="v2")
wid_vw2 = input.int(1, "Width", minval=1, group=grp_vwap, inline="v2")

show_vw3 = input.bool(false, "VWAP 3", group=grp_vwap, inline="v3")
day_vw3 = input.float(7, "Days", minval=0.1, step=0.5, group=grp_vwap, inline="v3")
col_vw3 = input.color(color.new(#5d87a1, 0), "", group=grp_vwap, inline="v3")
wid_vw3 = input.int(1, "Width", minval=1, group=grp_vwap, inline="v3")

show_vw4 = input.bool(false, "VWAP 4", group=grp_vwap, inline="v4")
day_vw4 = input.float(30, "Days", minval=0.1, step=0.5, group=grp_vwap, inline="v4")
col_vw4 = input.color(color.new(#8d6e63, 0), "", group=grp_vwap, inline="v4")
wid_vw4 = input.int(1, "Width", minval=1, group=grp_vwap, inline="v4")

// --- Session VWAP with Std Dev Bands (for intraday) ---
grp_vwap_bands = "Session VWAP + Bands (Intraday)"
show_session_vwap = input.bool(false, "Show Session VWAP", group=grp_vwap_bands)
show_vwap_bands = input.bool(false, "Show Std Dev Bands", group=grp_vwap_bands)
col_vwap = input.color(color.purple, "VWAP Color", group=grp_vwap_bands)
show_danger_zone = input.bool(false, "Highlight Danger Zone (±0.3σ)", group=grp_vwap_bands)

// --- Two-Close Rule Filter ---
grp_twoclose = "Two-Close Confirmation Rule"
show_two_close = input.bool(true, "Show Two-Close Confirmations", group=grp_twoclose)

// --- Label Settings ---
grp_lbl = "Label Style"
show_labels = input.bool(true, "Show MA Labels", group=grp_lbl)
lbl_offset = input.int(5, "Label Offset", minval=1, maxval=20, group=grp_lbl)
lbl_size_str = input.string("small", "Size", options=["auto", "tiny", "small", "normal", "large"], group=grp_lbl)
lbl_size = switch lbl_size_str
    "auto" => size.auto
    "tiny" => size.tiny
    "small" => size.small
    "normal" => size.normal
    "large" => size.large
    => size.small

// ==========================================
// 2. CALCULATIONS
// ==========================================

// --- CTA SMAs ---
sma20 = ta.sma(close, 20)
sma50 = ta.sma(close, 50)
sma120 = ta.sma(close, 120)
sma200 = ta.sma(close, 200)

// --- EMAs (for intraday reference) ---
v_ema1 = show_ema1 ? ta.ema(close, len_ema1) : na
v_ema2 = show_ema2 ? ta.ema(close, len_ema2) : na
v_ema3 = show_ema3 ? ta.ema(close, len_ema3) : na

// --- Rolling VWAP Calculations (Ryan's original logic) ---
f_calc_bars(_days) =>
    _mins_per_bar = timeframe.in_seconds(timeframe.period) / 60
    _safe_mins = _mins_per_bar > 0 ? _mins_per_bar : 1440
    math.max(1, int((_days * 1440) / _safe_mins))

len_vw1 = f_calc_bars(day_vw1)
len_vw2 = f_calc_bars(day_vw2)
len_vw3 = f_calc_bars(day_vw3)
len_vw4 = f_calc_bars(day_vw4)

v_vw1 = show_vw1 ? ta.vwma(hlc3, len_vw1) : na
v_vw2 = show_vw2 ? ta.vwma(hlc3, len_vw2) : na
v_vw3 = show_vw3 ? ta.vwma(hlc3, len_vw3) : na
v_vw4 = show_vw4 ? ta.vwma(hlc3, len_vw4) : na

// --- Session VWAP with Bands ---
vwap_val = show_session_vwap ? ta.vwap(hlc3) : na
vwap_stdev = ta.stdev(hlc3, 20)
vwap_upper1 = show_vwap_bands ? vwap_val + vwap_stdev : na
vwap_lower1 = show_vwap_bands ? vwap_val - vwap_stdev : na
vwap_upper2 = show_vwap_bands ? vwap_val + 2 * vwap_stdev : na
vwap_lower2 = show_vwap_bands ? vwap_val - 2 * vwap_stdev : na

// --- CTA Zone Detection ---
zone_max_long = close > sma20 and close > sma50 and close > sma120
zone_delever = close < sma20 and close >= sma50
zone_waterfall = close < sma50 and sma20 >= sma120
zone_capitulation = sma20 < sma120

// --- Volume Confirmation ---
vol_avg = ta.sma(volume, vol_avg_period)
vol_breakout = volume > vol_avg * vol_threshold

// --- Golden Touch Detection ---
// Detects first touch of 120 SMA after extended period above it
bars_above_120 = ta.barssince(close < sma120)
highest_since_above = ta.highest(high, math.max(1, bars_above_120))
correction_pct = (highest_since_above - close) / highest_since_above * 100
golden_touch = show_golden_touch and 
               ta.crossunder(close, sma120) and 
               bars_above_120 > golden_min_bars and 
               correction_pct >= golden_correction_pct and
               sma20 > sma120  // Still in overall uptrend

// --- Two-Close Rule Detection ---
// Price closes above/below key level for 2 consecutive days
two_close_above_50 = close > sma50 and close[1] > sma50[1] and close[2] <= sma50[2]
two_close_below_50 = close < sma50 and close[1] < sma50[1] and close[2] >= sma50[2]
two_close_above_20 = close > sma20 and close[1] > sma20[1] and close[2] <= sma20[2]
two_close_below_20 = close < sma20 and close[1] < sma20[1] and close[2] >= sma20[2]

// --- SMA Crossovers ---
cross_20_above_50 = ta.crossover(sma20, sma50)
cross_20_below_50 = ta.crossunder(sma20, sma50)
cross_20_above_120 = ta.crossover(sma20, sma120)
cross_20_below_120 = ta.crossunder(sma20, sma120)

// ==========================================
// 3. PLOTTING
// ==========================================

// --- CTA SMAs ---
plot(show_sma20 ? sma20 : na, "SMA 20", col_sma20, wid_sma20)
plot(show_sma50 ? sma50 : na, "SMA 50", col_sma50, wid_sma50)
plot(show_sma120 ? sma120 : na, "SMA 120", col_sma120, wid_sma120)
plot(show_sma200 ? sma200 : na, "SMA 200", col_sma200, wid_sma200)

// --- EMAs ---
plot(v_ema1, "EMA 1", col_ema1, wid_ema1)
plot(v_ema2, "EMA 2", col_ema2, wid_ema2)
plot(v_ema3, "EMA 3", col_ema3, wid_ema3)

// --- Rolling VWAPs ---
plot(v_vw1, "VWAP 1", col_vw1, wid_vw1)
plot(v_vw2, "VWAP 2", col_vw2, wid_vw2)
plot(v_vw3, "VWAP 3", col_vw3, wid_vw3)
plot(v_vw4, "VWAP 4", col_vw4, wid_vw4)

// --- Session VWAP + Bands ---
plot(vwap_val, "Session VWAP", col_vwap, 2)
plot(vwap_upper1, "VWAP +1σ", color.new(col_vwap, 50), 1)
plot(vwap_lower1, "VWAP -1σ", color.new(col_vwap, 50), 1)
plot(vwap_upper2, "VWAP +2σ", color.new(col_vwap, 70), 1, style=plot.style_circles)
plot(vwap_lower2, "VWAP -2σ", color.new(col_vwap, 70), 1, style=plot.style_circles)

// --- CTA Zone Background ---
zone_color = show_cta_system and show_zone_bg ? 
    (zone_max_long ? color.new(col_max_long, zone_transparency) : 
     zone_delever ? color.new(col_delever, zone_transparency) : 
     zone_waterfall ? color.new(col_waterfall, zone_transparency) : 
     zone_capitulation ? color.new(col_capitulation, zone_transparency) : na) : na

bgcolor(zone_color, title="CTA Zone Background")

// --- VWAP Danger Zone (for intraday) ---
danger_zone = show_danger_zone and show_session_vwap and 
              close > vwap_val - 0.3 * vwap_stdev and 
              close < vwap_val + 0.3 * vwap_stdev
bgcolor(danger_zone ? color.new(color.gray, 85) : na, title="VWAP Danger Zone")

// ==========================================
// 4. SIGNAL SHAPES
// ==========================================

// --- Volume Breakout Confirmation ---
plotshape(show_vol_signals and vol_breakout and ta.crossover(close, sma50), 
          style=shape.triangleup, location=location.belowbar, 
          color=color.green, size=size.small, text="VOL+50")

plotshape(show_vol_signals and vol_breakout and ta.crossunder(close, sma50), 
          style=shape.triangledown, location=location.abovebar, 
          color=color.red, size=size.small, text="VOL-50")

// --- Golden Touch (120 SMA) ---
plotshape(golden_touch, 
          style=shape.diamond, location=location.belowbar,
          color=color.new(color.yellow, 0), size=size.normal, text="120 TOUCH")

// --- Two-Close Confirmations ---
plotshape(show_two_close and two_close_above_50 and vol_breakout, 
          style=shape.labelup, location=location.belowbar, 
          color=color.green, size=size.tiny, text="2C↑50")

plotshape(show_two_close and two_close_below_50, 
          style=shape.labeldown, location=location.abovebar, 
          color=color.red, size=size.tiny, text="2C↓50")

// --- SMA Crossovers (Regime Changes) ---
plotshape(cross_20_below_120, 
          style=shape.xcross, location=location.abovebar,
          color=color.red, size=size.normal, text="CAPITULATION")

plotshape(cross_20_above_120, 
          style=shape.cross, location=location.belowbar,
          color=color.green, size=size.normal, text="RECOVERY")

// ==========================================
// 5. LABELS
// ==========================================

f_draw_label(_show_line, _show_lbl, _val, _text, _color, _offset, _size) =>
    var label my_label = label.new(na, na, style=label.style_label_left, textcolor=color.white)
    if _show_line and _show_lbl and not na(_val)
        if barstate.islast
            label.set_xy(my_label, bar_index + _offset, _val)
            label.set_text(my_label, _text)
            label.set_color(my_label, _color)
            label.set_size(my_label, _size)
            label.set_style(my_label, label.style_label_left)
    else
        label.set_xy(my_label, na, na)

// CTA SMA Labels
f_draw_label(show_sma20, show_labels, sma20, "SMA 20", col_sma20, lbl_offset, lbl_size)
f_draw_label(show_sma50, show_labels, sma50, "SMA 50", col_sma50, lbl_offset, lbl_size)
f_draw_label(show_sma120, show_labels, sma120, "SMA 120", col_sma120, lbl_offset, lbl_size)
f_draw_label(show_sma200, show_labels, sma200, "SMA 200", col_sma200, lbl_offset, lbl_size)

// EMA Labels
f_draw_label(show_ema1, show_labels, v_ema1, "EMA " + str.tostring(len_ema1), col_ema1, lbl_offset, lbl_size)
f_draw_label(show_ema2, show_labels, v_ema2, "EMA " + str.tostring(len_ema2), col_ema2, lbl_offset, lbl_size)
f_draw_label(show_ema3, show_labels, v_ema3, "EMA " + str.tostring(len_ema3), col_ema3, lbl_offset, lbl_size)

// Rolling VWAP Labels
f_draw_label(show_vw1, show_labels, v_vw1, "VWAP " + str.tostring(day_vw1) + "d", col_vw1, lbl_offset + 10, lbl_size)
f_draw_label(show_vw2, show_labels, v_vw2, "VWAP " + str.tostring(day_vw2) + "d", col_vw2, lbl_offset + 10, lbl_size)
f_draw_label(show_vw3, show_labels, v_vw3, "VWAP " + str.tostring(day_vw3) + "d", col_vw3, lbl_offset + 10, lbl_size)
f_draw_label(show_vw4, show_labels, v_vw4, "VWAP " + str.tostring(day_vw4) + "d", col_vw4, lbl_offset + 10, lbl_size)

// --- CTA Zone Label ---
var label zone_label = label.new(na, na, style=label.style_label_lower_left, textcolor=color.white, size=size.normal)
if show_cta_system and show_zone_label and barstate.islast
    zone_text = zone_max_long ? "MAX LONG" : 
                zone_delever ? "DE-LEVER" : 
                zone_waterfall ? "WATERFALL" : 
                zone_capitulation ? "CAPITULATION" : "NEUTRAL"
    zone_label_color = zone_max_long ? col_max_long : 
                       zone_delever ? col_delever : 
                       zone_waterfall ? col_waterfall : 
                       zone_capitulation ? col_capitulation : color.gray
    label.set_xy(zone_label, bar_index + 2, high * 1.001)
    label.set_text(zone_label, "CTA: " + zone_text)
    label.set_color(zone_label, zone_label_color)

// ==========================================
// 6. INFO TABLE
// ==========================================

grp_table = "INFO TABLE"
show_table = input.bool(true, "Show Info Table", group=grp_table)
table_pos_str = input.string("top_right", "Position", options=["top_right", "top_left", "bottom_right", "bottom_left"], group=grp_table)
table_pos = switch table_pos_str
    "top_right" => position.top_right
    "top_left" => position.top_left
    "bottom_right" => position.bottom_right
    "bottom_left" => position.bottom_left
    => position.top_right

var table info_tbl = table.new(table_pos, 3, 12, border_width=1)

if barstate.islast and show_table
    // Header
    table.cell(info_tbl, 0, 0, "Indicator", bgcolor=color.gray, text_color=color.white)
    table.cell(info_tbl, 1, 0, "Value", bgcolor=color.gray, text_color=color.white)
    table.cell(info_tbl, 2, 0, "Status", bgcolor=color.gray, text_color=color.white)
    
    // CTA Zone
    zone_text = zone_max_long ? "MAX LONG" : zone_delever ? "DE-LEVER" : zone_waterfall ? "WATERFALL" : zone_capitulation ? "CAPITULATION" : "NEUTRAL"
    zone_bg = zone_max_long ? col_max_long : zone_delever ? col_delever : zone_waterfall ? col_waterfall : zone_capitulation ? col_capitulation : color.gray
    table.cell(info_tbl, 0, 1, "CTA ZONE", bgcolor=zone_bg, text_color=color.white)
    table.cell(info_tbl, 1, 1, zone_text, bgcolor=color.new(color.gray, 90), text_color=chart.fg_color)
    table.cell(info_tbl, 2, 1, "", bgcolor=color.new(color.gray, 90))
    
    // SMAs with price position
    price_vs_20 = close > sma20 ? "ABOVE" : "BELOW"
    price_vs_50 = close > sma50 ? "ABOVE" : "BELOW"
    price_vs_120 = close > sma120 ? "ABOVE" : "BELOW"
    price_vs_200 = close > sma200 ? "ABOVE" : "BELOW"
    
    table.cell(info_tbl, 0, 2, "SMA 20", bgcolor=col_sma20, text_color=color.white)
    table.cell(info_tbl, 1, 2, str.tostring(sma20, format.mintick), bgcolor=color.new(color.gray, 90), text_color=chart.fg_color)
    table.cell(info_tbl, 2, 2, price_vs_20, bgcolor=close > sma20 ? color.new(color.green, 70) : color.new(color.red, 70), text_color=color.white)
    
    table.cell(info_tbl, 0, 3, "SMA 50", bgcolor=col_sma50, text_color=color.white)
    table.cell(info_tbl, 1, 3, str.tostring(sma50, format.mintick), bgcolor=color.new(color.gray, 90), text_color=chart.fg_color)
    table.cell(info_tbl, 2, 3, price_vs_50, bgcolor=close > sma50 ? color.new(color.green, 70) : color.new(color.red, 70), text_color=color.white)
    
    table.cell(info_tbl, 0, 4, "SMA 120", bgcolor=col_sma120, text_color=color.white)
    table.cell(info_tbl, 1, 4, str.tostring(sma120, format.mintick), bgcolor=color.new(color.gray, 90), text_color=chart.fg_color)
    table.cell(info_tbl, 2, 4, price_vs_120, bgcolor=close > sma120 ? color.new(color.green, 70) : color.new(color.red, 70), text_color=color.white)
    
    table.cell(info_tbl, 0, 5, "SMA 200", bgcolor=col_sma200, text_color=color.white)
    table.cell(info_tbl, 1, 5, str.tostring(sma200, format.mintick), bgcolor=color.new(color.gray, 90), text_color=chart.fg_color)
    table.cell(info_tbl, 2, 5, price_vs_200, bgcolor=close > sma200 ? color.new(color.green, 70) : color.new(color.red, 70), text_color=color.white)
    
    // Volume Status
    vol_status = vol_breakout ? "CONFIRMED" : "NORMAL"
    vol_pct = (volume / vol_avg - 1) * 100
    table.cell(info_tbl, 0, 6, "VOLUME", bgcolor=color.blue, text_color=color.white)
    table.cell(info_tbl, 1, 6, str.tostring(vol_pct, "#.0") + "% vs avg", bgcolor=color.new(color.gray, 90), text_color=chart.fg_color)
    table.cell(info_tbl, 2, 6, vol_status, bgcolor=vol_breakout ? color.new(color.green, 70) : color.new(color.gray, 70), text_color=color.white)
    
    // Distance to key levels
    dist_to_50 = (close - sma50) / sma50 * 100
    dist_to_120 = (close - sma120) / sma120 * 100
    table.cell(info_tbl, 0, 7, "Dist to 50", bgcolor=color.new(color.gray, 50), text_color=color.white)
    table.cell(info_tbl, 1, 7, str.tostring(dist_to_50, "#.1") + "%", bgcolor=color.new(color.gray, 90), text_color=chart.fg_color)
    table.cell(info_tbl, 2, 7, "", bgcolor=color.new(color.gray, 90))
    
    table.cell(info_tbl, 0, 8, "Dist to 120", bgcolor=color.new(color.gray, 50), text_color=color.white)
    table.cell(info_tbl, 1, 8, str.tostring(dist_to_120, "#.1") + "%", bgcolor=color.new(color.gray, 90), text_color=chart.fg_color)
    table.cell(info_tbl, 2, 8, "", bgcolor=color.new(color.gray, 90))

else if not show_table
    table.clear(info_tbl, 0, 0, 2, 11)

// ==========================================
// 7. ALERTS
// ==========================================

// Zone Transition Alerts
alertcondition(zone_max_long and not zone_max_long[1], "Entered Max Long Zone", "Price entered MAX LONG zone (above all SMAs)")
alertcondition(zone_delever and not zone_delever[1], "Entered De-Leveraging Zone", "Price entered DE-LEVERAGING zone (below 20, above 50)")
alertcondition(zone_waterfall and not zone_waterfall[1], "Entered Waterfall Zone", "Price entered WATERFALL zone (below 50)")
alertcondition(zone_capitulation and not zone_capitulation[1], "Entered Capitulation Zone", "CAPITULATION triggered (20 SMA crossed below 120)")

// Key Level Alerts
alertcondition(ta.crossover(close, sma50), "Price Reclaimed 50 SMA", "Price crossed ABOVE 50 SMA")
alertcondition(ta.crossunder(close, sma50), "Price Lost 50 SMA", "Price crossed BELOW 50 SMA")
alertcondition(ta.crossover(close, sma120), "Price Reclaimed 120 SMA", "Price crossed ABOVE 120 SMA")
alertcondition(ta.crossunder(close, sma120), "Price Lost 120 SMA", "Price crossed BELOW 120 SMA")

// Two-Close Confirmations
alertcondition(two_close_above_50, "Two-Close Above 50 SMA", "Two consecutive closes ABOVE 50 SMA - potential long entry")
alertcondition(two_close_below_50, "Two-Close Below 50 SMA", "Two consecutive closes BELOW 50 SMA - potential short/exit")

// Golden Touch
alertcondition(golden_touch, "120 SMA Golden Touch", "First touch of 120 SMA after extended rally - HIGH PROBABILITY long setup")

// Volume Confirmation
alertcondition(vol_breakout and ta.crossover(close, sma50), "Volume Confirmed 50 SMA Breakout", "Price broke above 50 SMA with volume confirmation")

// SMA Crossovers (Regime Changes)
alertcondition(cross_20_below_120, "Capitulation Cross", "20 SMA crossed BELOW 120 SMA - CAPITULATION signal")
alertcondition(cross_20_above_120, "Recovery Cross", "20 SMA crossed ABOVE 120 SMA - RECOVERY signal")
